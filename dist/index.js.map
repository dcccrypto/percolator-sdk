{"version":3,"sources":["../src/abi/encode.ts","../src/abi/instructions.ts","../src/abi/accounts.ts","../src/abi/errors.ts","../src/solana/slab.ts","../src/solana/pda.ts","../src/solana/ata.ts","../src/solana/discovery.ts","../src/solana/dex-oracle.ts","../src/solana/token-program.ts","../src/solana/stake.ts","../src/runtime/tx.ts","../src/math/trading.ts","../src/validation.ts","../src/oracle/price-router.ts","../src/config/program-ids.ts"],"sourcesContent":["import { PublicKey } from \"@solana/web3.js\";\n\n/**\n * Encode u8 (1 byte)\n */\nexport function encU8(val: number): Uint8Array {\n  return new Uint8Array([val & 0xff]);\n}\n\n/**\n * Encode u16 little-endian (2 bytes)\n */\nexport function encU16(val: number): Uint8Array {\n  const buf = new Uint8Array(2);\n  new DataView(buf.buffer).setUint16(0, val, true);\n  return buf;\n}\n\n/**\n * Encode u32 little-endian (4 bytes)\n */\nexport function encU32(val: number): Uint8Array {\n  const buf = new Uint8Array(4);\n  new DataView(buf.buffer).setUint32(0, val, true);\n  return buf;\n}\n\n/**\n * Encode u64 little-endian (8 bytes)\n * Input: bigint or string (decimal)\n */\nexport function encU64(val: bigint | string): Uint8Array {\n  const n = typeof val === \"string\" ? BigInt(val) : val;\n  if (n < 0n) throw new Error(\"encU64: value must be non-negative\");\n  if (n > 0xffff_ffff_ffff_ffffn) throw new Error(\"encU64: value exceeds u64 max\");\n  const buf = new Uint8Array(8);\n  new DataView(buf.buffer).setBigUint64(0, n, true);\n  return buf;\n}\n\n/**\n * Encode i64 little-endian (8 bytes), two's complement\n * Input: bigint or string (decimal, may be negative)\n */\nexport function encI64(val: bigint | string): Uint8Array {\n  const n = typeof val === \"string\" ? BigInt(val) : val;\n  const min = -(1n << 63n);\n  const max = (1n << 63n) - 1n;\n  if (n < min || n > max) throw new Error(\"encI64: value out of range\");\n  const buf = new Uint8Array(8);\n  new DataView(buf.buffer).setBigInt64(0, n, true);\n  return buf;\n}\n\n/**\n * Encode u128 little-endian (16 bytes)\n * Input: bigint or string (decimal)\n */\nexport function encU128(val: bigint | string): Uint8Array {\n  const n = typeof val === \"string\" ? BigInt(val) : val;\n  if (n < 0n) throw new Error(\"encU128: value must be non-negative\");\n  const max = (1n << 128n) - 1n;\n  if (n > max) throw new Error(\"encU128: value exceeds u128 max\");\n  const buf = new Uint8Array(16);\n  const view = new DataView(buf.buffer);\n  const lo = n & 0xffff_ffff_ffff_ffffn;\n  const hi = n >> 64n;\n  view.setBigUint64(0, lo, true);\n  view.setBigUint64(8, hi, true);\n  return buf;\n}\n\n/**\n * Encode i128 little-endian (16 bytes), two's complement\n * Input: bigint or string (decimal, may be negative)\n */\nexport function encI128(val: bigint | string): Uint8Array {\n  const n = typeof val === \"string\" ? BigInt(val) : val;\n  const min = -(1n << 127n);\n  const max = (1n << 127n) - 1n;\n  if (n < min || n > max) throw new Error(\"encI128: value out of range\");\n\n  // Convert to unsigned representation (two's complement)\n  let unsigned = n;\n  if (n < 0n) {\n    unsigned = (1n << 128n) + n;\n  }\n\n  const buf = new Uint8Array(16);\n  const view = new DataView(buf.buffer);\n  const lo = unsigned & 0xffff_ffff_ffff_ffffn;\n  const hi = unsigned >> 64n;\n  view.setBigUint64(0, lo, true);\n  view.setBigUint64(8, hi, true);\n  return buf;\n}\n\n/**\n * Encode a PublicKey (32 bytes)\n * Input: PublicKey or base58 string\n */\nexport function encPubkey(val: PublicKey | string): Uint8Array {\n  const pk = typeof val === \"string\" ? new PublicKey(val) : val;\n  return pk.toBytes();\n}\n\n/**\n * Encode a boolean as u8 (0 = false, 1 = true)\n */\nexport function encBool(val: boolean): Uint8Array {\n  return encU8(val ? 1 : 0);\n}\n\n/**\n * Concatenate multiple Uint8Arrays (replaces Buffer.concat)\n */\nexport function concatBytes(...arrays: Uint8Array[]): Uint8Array {\n  const totalLen = arrays.reduce((sum, a) => sum + a.length, 0);\n  const result = new Uint8Array(totalLen);\n  let offset = 0;\n  for (const arr of arrays) {\n    result.set(arr, offset);\n    offset += arr.length;\n  }\n  return result;\n}\n","import { PublicKey } from \"@solana/web3.js\";\nimport {\n  encU8,\n  encU16,\n  encU32,\n  encU64,\n  encI64,\n  encU128,\n  encI128,\n  encPubkey,\n  concatBytes,\n} from \"./encode.js\";\n\n/**\n * Instruction tags - exact match to Rust ix::Instruction::decode\n */\nexport const IX_TAG = {\n  InitMarket: 0,\n  InitUser: 1,\n  InitLP: 2,\n  DepositCollateral: 3,\n  WithdrawCollateral: 4,\n  KeeperCrank: 5,\n  TradeNoCpi: 6,\n  LiquidateAtOracle: 7,\n  CloseAccount: 8,\n  TopUpInsurance: 9,\n  TradeCpi: 10,\n  SetRiskThreshold: 11,\n  UpdateAdmin: 12,\n  CloseSlab: 13,\n  UpdateConfig: 14,\n  SetMaintenanceFee: 15,\n  SetOracleAuthority: 16,\n  PushOraclePrice: 17,\n  SetOraclePriceCap: 18,\n  ResolveMarket: 19,\n  WithdrawInsurance: 20,\n  AdminForceClose: 21,\n  UpdateRiskParams: 22,\n  RenounceAdmin: 23,\n  CreateInsuranceMint: 24,\n  DepositInsuranceLP: 25,\n  WithdrawInsuranceLP: 26,\n  PauseMarket: 27,\n  UnpauseMarket: 28,\n} as const;\n\n/**\n * InitMarket instruction data (256 bytes total)\n * Layout: tag(1) + admin(32) + mint(32) + indexFeedId(32) +\n *         maxStaleSecs(8) + confFilter(2) + invert(1) + unitScale(4) +\n *         RiskParams(144)\n *\n * Note: indexFeedId is the Pyth Pull feed ID (32 bytes hex), NOT an oracle pubkey.\n * The program validates PriceUpdateV2 accounts against this feed ID at runtime.\n */\nexport interface InitMarketArgs {\n  admin: PublicKey | string;\n  collateralMint: PublicKey | string;\n  indexFeedId: string;           // Pyth feed ID (hex string, 64 chars without 0x prefix). All zeros = Hyperp mode.\n  maxStalenessSecs: bigint | string;  // Max staleness in SECONDS (Pyth Pull uses unix timestamps)\n  confFilterBps: number;\n  invert: number;              // 0 = no inversion, 1 = invert oracle price (USD/SOL -> SOL/USD)\n  unitScale: number;           // Lamports per unit (0 = no scaling, e.g. 1000 = 1 SOL = 1,000,000 units)\n  initialMarkPriceE6: bigint | string;  // Initial mark price (required non-zero for Hyperp mode)\n  warmupPeriodSlots: bigint | string;\n  maintenanceMarginBps: bigint | string;\n  initialMarginBps: bigint | string;\n  tradingFeeBps: bigint | string;\n  maxAccounts: bigint | string;\n  newAccountFee: bigint | string;\n  riskReductionThreshold: bigint | string;\n  maintenanceFeePerSlot: bigint | string;\n  maxCrankStalenessSlots: bigint | string;\n  liquidationFeeBps: bigint | string;\n  liquidationFeeCap: bigint | string;\n  liquidationBufferBps: bigint | string;\n  minLiquidationAbs: bigint | string;\n}\n\n/**\n * Encode a Pyth feed ID (hex string) to 32-byte Uint8Array.\n */\nfunction encodeFeedId(feedId: string): Uint8Array {\n  // Remove 0x prefix if present\n  const hex = feedId.startsWith(\"0x\") ? feedId.slice(2) : feedId;\n  if (hex.length !== 64) {\n    throw new Error(`Invalid feed ID length: expected 64 hex chars, got ${hex.length}`);\n  }\n  const bytes = new Uint8Array(32);\n  for (let i = 0; i < 64; i += 2) {\n    bytes[i / 2] = parseInt(hex.substring(i, i + 2), 16);\n  }\n  return bytes;\n}\n\nexport function encodeInitMarket(args: InitMarketArgs): Uint8Array {\n  // Layout: tag(1) + admin(32) + mint(32) + index_feed_id(32) + max_staleness_secs(8) +\n  //         conf_filter_bps(2) + invert(1) + unit_scale(4) + initial_mark_price_e6(8) + RiskParams(...)\n  // Note: _reserved field is only in MarketConfig on-chain, not in instruction data\n  return concatBytes(\n    encU8(IX_TAG.InitMarket),\n    encPubkey(args.admin),\n    encPubkey(args.collateralMint),\n    encodeFeedId(args.indexFeedId),   // index_feed_id (32 bytes) - all zeros for Hyperp mode\n    encU64(args.maxStalenessSecs),    // max_staleness_secs (Pyth Pull uses unix timestamps)\n    encU16(args.confFilterBps),\n    encU8(args.invert),\n    encU32(args.unitScale),\n    encU64(args.initialMarkPriceE6),  // initial_mark_price_e6 (required non-zero for Hyperp)\n    encU64(args.warmupPeriodSlots),\n    encU64(args.maintenanceMarginBps),\n    encU64(args.initialMarginBps),\n    encU64(args.tradingFeeBps),\n    encU64(args.maxAccounts),\n    encU128(args.newAccountFee),\n    encU128(args.riskReductionThreshold),\n    encU128(args.maintenanceFeePerSlot),\n    encU64(args.maxCrankStalenessSlots),\n    encU64(args.liquidationFeeBps),\n    encU128(args.liquidationFeeCap),\n    encU64(args.liquidationBufferBps),\n    encU128(args.minLiquidationAbs),\n  );\n}\n\n/**\n * InitUser instruction data (9 bytes)\n */\nexport interface InitUserArgs {\n  feePayment: bigint | string;\n}\n\nexport function encodeInitUser(args: InitUserArgs): Uint8Array {\n  return concatBytes(encU8(IX_TAG.InitUser), encU64(args.feePayment));\n}\n\n/**\n * InitLP instruction data (73 bytes)\n */\nexport interface InitLPArgs {\n  matcherProgram: PublicKey | string;\n  matcherContext: PublicKey | string;\n  feePayment: bigint | string;\n}\n\nexport function encodeInitLP(args: InitLPArgs): Uint8Array {\n  return concatBytes(\n    encU8(IX_TAG.InitLP),\n    encPubkey(args.matcherProgram),\n    encPubkey(args.matcherContext),\n    encU64(args.feePayment),\n  );\n}\n\n/**\n * DepositCollateral instruction data (11 bytes)\n */\nexport interface DepositCollateralArgs {\n  userIdx: number;\n  amount: bigint | string;\n}\n\nexport function encodeDepositCollateral(args: DepositCollateralArgs): Uint8Array {\n  return concatBytes(\n    encU8(IX_TAG.DepositCollateral),\n    encU16(args.userIdx),\n    encU64(args.amount),\n  );\n}\n\n/**\n * WithdrawCollateral instruction data (11 bytes)\n */\nexport interface WithdrawCollateralArgs {\n  userIdx: number;\n  amount: bigint | string;\n}\n\nexport function encodeWithdrawCollateral(args: WithdrawCollateralArgs): Uint8Array {\n  return concatBytes(\n    encU8(IX_TAG.WithdrawCollateral),\n    encU16(args.userIdx),\n    encU64(args.amount),\n  );\n}\n\n/**\n * KeeperCrank instruction data (4 bytes)\n * Funding rate is computed on-chain from LP inventory.\n */\nexport interface KeeperCrankArgs {\n  callerIdx: number;\n  allowPanic: boolean;\n}\n\nexport function encodeKeeperCrank(args: KeeperCrankArgs): Uint8Array {\n  return concatBytes(\n    encU8(IX_TAG.KeeperCrank),\n    encU16(args.callerIdx),\n    encU8(args.allowPanic ? 1 : 0),\n  );\n}\n\n/**\n * TradeNoCpi instruction data (21 bytes)\n */\nexport interface TradeNoCpiArgs {\n  lpIdx: number;\n  userIdx: number;\n  size: bigint | string;\n}\n\nexport function encodeTradeNoCpi(args: TradeNoCpiArgs): Uint8Array {\n  return concatBytes(\n    encU8(IX_TAG.TradeNoCpi),\n    encU16(args.lpIdx),\n    encU16(args.userIdx),\n    encI128(args.size),\n  );\n}\n\n/**\n * LiquidateAtOracle instruction data (3 bytes)\n */\nexport interface LiquidateAtOracleArgs {\n  targetIdx: number;\n}\n\nexport function encodeLiquidateAtOracle(args: LiquidateAtOracleArgs): Uint8Array {\n  return concatBytes(\n    encU8(IX_TAG.LiquidateAtOracle),\n    encU16(args.targetIdx),\n  );\n}\n\n/**\n * CloseAccount instruction data (3 bytes)\n */\nexport interface CloseAccountArgs {\n  userIdx: number;\n}\n\nexport function encodeCloseAccount(args: CloseAccountArgs): Uint8Array {\n  return concatBytes(encU8(IX_TAG.CloseAccount), encU16(args.userIdx));\n}\n\n/**\n * TopUpInsurance instruction data (9 bytes)\n */\nexport interface TopUpInsuranceArgs {\n  amount: bigint | string;\n}\n\nexport function encodeTopUpInsurance(args: TopUpInsuranceArgs): Uint8Array {\n  return concatBytes(encU8(IX_TAG.TopUpInsurance), encU64(args.amount));\n}\n\n/**\n * TradeCpi instruction data (21 bytes)\n */\nexport interface TradeCpiArgs {\n  lpIdx: number;\n  userIdx: number;\n  size: bigint | string;\n}\n\nexport function encodeTradeCpi(args: TradeCpiArgs): Uint8Array {\n  return concatBytes(\n    encU8(IX_TAG.TradeCpi),\n    encU16(args.lpIdx),\n    encU16(args.userIdx),\n    encI128(args.size),\n  );\n}\n\n/**\n * SetRiskThreshold instruction data (17 bytes)\n */\nexport interface SetRiskThresholdArgs {\n  newThreshold: bigint | string;\n}\n\nexport function encodeSetRiskThreshold(args: SetRiskThresholdArgs): Uint8Array {\n  return concatBytes(\n    encU8(IX_TAG.SetRiskThreshold),\n    encU128(args.newThreshold),\n  );\n}\n\n/**\n * UpdateAdmin instruction data (33 bytes)\n */\nexport interface UpdateAdminArgs {\n  newAdmin: PublicKey | string;\n}\n\nexport function encodeUpdateAdmin(args: UpdateAdminArgs): Uint8Array {\n  return concatBytes(encU8(IX_TAG.UpdateAdmin), encPubkey(args.newAdmin));\n}\n\n/**\n * CloseSlab instruction data (1 byte)\n */\nexport function encodeCloseSlab(): Uint8Array {\n  return encU8(IX_TAG.CloseSlab);\n}\n\n/**\n * UpdateConfig instruction data\n * Updates funding and threshold parameters at runtime (admin only)\n */\nexport interface UpdateConfigArgs {\n  // Funding parameters\n  fundingHorizonSlots: bigint | string;\n  fundingKBps: bigint | string;\n  fundingInvScaleNotionalE6: bigint | string;\n  fundingMaxPremiumBps: bigint | string;\n  fundingMaxBpsPerSlot: bigint | string;\n  // Threshold parameters\n  threshFloor: bigint | string;\n  threshRiskBps: bigint | string;\n  threshUpdateIntervalSlots: bigint | string;\n  threshStepBps: bigint | string;\n  threshAlphaBps: bigint | string;\n  threshMin: bigint | string;\n  threshMax: bigint | string;\n  threshMinStep: bigint | string;\n}\n\nexport function encodeUpdateConfig(args: UpdateConfigArgs): Uint8Array {\n  return concatBytes(\n    encU8(IX_TAG.UpdateConfig),\n    encU64(args.fundingHorizonSlots),\n    encU64(args.fundingKBps),\n    encU128(args.fundingInvScaleNotionalE6),\n    encI64(args.fundingMaxPremiumBps),  // Rust: i64 (can be negative)\n    encI64(args.fundingMaxBpsPerSlot),  // Rust: i64 (can be negative)\n    encU128(args.threshFloor),\n    encU64(args.threshRiskBps),\n    encU64(args.threshUpdateIntervalSlots),\n    encU64(args.threshStepBps),\n    encU64(args.threshAlphaBps),\n    encU128(args.threshMin),\n    encU128(args.threshMax),\n    encU128(args.threshMinStep),\n  );\n}\n\n/**\n * SetMaintenanceFee instruction data (17 bytes)\n */\nexport interface SetMaintenanceFeeArgs {\n  newFee: bigint | string;\n}\n\nexport function encodeSetMaintenanceFee(args: SetMaintenanceFeeArgs): Uint8Array {\n  return concatBytes(\n    encU8(IX_TAG.SetMaintenanceFee),\n    encU128(args.newFee),\n  );\n}\n\n/**\n * SetOracleAuthority instruction data (33 bytes)\n * Sets the oracle price authority. Pass zero pubkey to disable and require Pyth/Chainlink.\n */\nexport interface SetOracleAuthorityArgs {\n  newAuthority: PublicKey | string;\n}\n\nexport function encodeSetOracleAuthority(args: SetOracleAuthorityArgs): Uint8Array {\n  return concatBytes(\n    encU8(IX_TAG.SetOracleAuthority),\n    encPubkey(args.newAuthority),\n  );\n}\n\n/**\n * PushOraclePrice instruction data (17 bytes)\n * Push a new oracle price (oracle authority only).\n * The price should be in e6 format and already include any inversion/scaling.\n */\nexport interface PushOraclePriceArgs {\n  priceE6: bigint | string;\n  timestamp: bigint | string;\n}\n\nexport function encodePushOraclePrice(args: PushOraclePriceArgs): Uint8Array {\n  return concatBytes(\n    encU8(IX_TAG.PushOraclePrice),\n    encU64(args.priceE6),\n    encI64(args.timestamp),\n  );\n}\n\n/**\n * SetOraclePriceCap instruction data (9 bytes)\n * Set oracle price circuit breaker cap (admin only).\n * max_change_e2bps in 0.01 bps units (1_000_000 = 100%). 0 = disabled.\n */\nexport interface SetOraclePriceCapArgs {\n  maxChangeE2bps: bigint | string;\n}\n\nexport function encodeSetOraclePriceCap(args: SetOraclePriceCapArgs): Uint8Array {\n  return concatBytes(\n    encU8(IX_TAG.SetOraclePriceCap),\n    encU64(args.maxChangeE2bps),\n  );\n}\n\n/**\n * ResolveMarket instruction data (1 byte)\n * Resolves a binary/premarket - sets RESOLVED flag, positions force-closed via crank.\n * Requires admin oracle price (authority_price_e6) to be set first.\n */\nexport function encodeResolveMarket(): Uint8Array {\n  return encU8(IX_TAG.ResolveMarket);\n}\n\n/**\n * WithdrawInsurance instruction data (1 byte)\n * Withdraw insurance fund to admin (requires RESOLVED and all positions closed).\n */\nexport function encodeWithdrawInsurance(): Uint8Array {\n  return encU8(IX_TAG.WithdrawInsurance);\n}\n\n/**\n * AdminForceClose instruction data (3 bytes)\n * Force-close any position at oracle price (admin only, skips margin checks).\n */\nexport interface AdminForceCloseArgs {\n  targetIdx: number;\n}\n\nexport function encodeAdminForceClose(args: AdminForceCloseArgs): Uint8Array {\n  return concatBytes(\n    encU8(IX_TAG.AdminForceClose),\n    encU16(args.targetIdx),\n  );\n}\n\n/**\n * UpdateRiskParams instruction data (17 or 25 bytes)\n * Update initial and maintenance margin BPS (admin only).\n *\n * R2-S13: The Rust program uses `data.len() >= 25` to detect the optional\n * tradingFeeBps field, so variable-length encoding is safe. When tradingFeeBps\n * is omitted, the data is 17 bytes (tag + 2×u64). When included, 25 bytes.\n */\nexport interface UpdateRiskParamsArgs {\n  initialMarginBps: bigint | string;\n  maintenanceMarginBps: bigint | string;\n  tradingFeeBps?: bigint | string;\n}\n\nexport function encodeUpdateRiskParams(args: UpdateRiskParamsArgs): Uint8Array {\n  const parts = [\n    encU8(IX_TAG.UpdateRiskParams),\n    encU64(args.initialMarginBps),\n    encU64(args.maintenanceMarginBps),\n  ];\n  if (args.tradingFeeBps !== undefined) {\n    parts.push(encU64(args.tradingFeeBps));\n  }\n  return concatBytes(...parts);\n}\n\n/**\n * RenounceAdmin instruction data (1 byte)\n * Irreversibly set admin to all zeros. After this, all admin-only instructions fail.\n */\nexport function encodeRenounceAdmin(): Uint8Array {\n  return encU8(IX_TAG.RenounceAdmin);\n}\n\n/**\n * CreateInsuranceMint instruction data (1 byte)\n * Creates the SPL mint PDA for insurance LP tokens. Admin only, once per market.\n */\nexport function encodeCreateInsuranceMint(): Uint8Array {\n  return encU8(IX_TAG.CreateInsuranceMint);\n}\n\n/**\n * DepositInsuranceLP instruction data (9 bytes)\n * Deposit collateral into insurance fund, receive LP tokens proportional to share.\n */\nexport interface DepositInsuranceLPArgs {\n  amount: bigint | string;\n}\n\nexport function encodeDepositInsuranceLP(args: DepositInsuranceLPArgs): Uint8Array {\n  return concatBytes(encU8(IX_TAG.DepositInsuranceLP), encU64(args.amount));\n}\n\n/**\n * WithdrawInsuranceLP instruction data (9 bytes)\n * Burn LP tokens and withdraw proportional share of insurance fund.\n */\nexport interface WithdrawInsuranceLPArgs {\n  lpAmount: bigint | string;\n}\n\nexport function encodeWithdrawInsuranceLP(args: WithdrawInsuranceLPArgs): Uint8Array {\n  return concatBytes(encU8(IX_TAG.WithdrawInsuranceLP), encU64(args.lpAmount));\n}\n\n/**\n * PauseMarket instruction data (1 byte)\n * Pauses the market — disables trading, deposits, and withdrawals.\n */\nexport function encodePauseMarket(): Uint8Array {\n  return encU8(IX_TAG.PauseMarket);\n}\n\n/**\n * UnpauseMarket instruction data (1 byte)\n * Unpauses the market — re-enables trading, deposits, and withdrawals.\n */\nexport function encodeUnpauseMarket(): Uint8Array {\n  return encU8(IX_TAG.UnpauseMarket);\n}\n\n// ============================================================================\n// PERC-117: Pyth Oracle CPI Instructions\n// ============================================================================\n\n/**\n * SetPythOracle (Tag 32) — switch a market to Pyth-pinned mode.\n *\n * After this instruction:\n * - oracle_authority is cleared → PushOraclePrice is disabled\n * - index_feed_id is set to feed_id → validated on every price read\n * - max_staleness_secs and conf_filter_bps are updated\n * - All price reads go directly to read_pyth_price_e6() with on-chain\n *   staleness + confidence + feed-ID validation (no silent fallback)\n *\n * Instruction data: tag(1) + feed_id(32) + max_staleness_secs(8) + conf_filter_bps(2) = 43 bytes\n *\n * Accounts:\n *   0. [signer, writable] Admin\n *   1. [writable]         Slab\n */\nexport interface SetPythOracleArgs {\n  /** 32-byte Pyth feed ID. All zeros is invalid (reserved for Hyperp mode). */\n  feedId: Uint8Array;\n  /** Maximum age of Pyth price in seconds before OracleStale is returned. Must be > 0. */\n  maxStalenessSecs: bigint;\n  /** Max confidence/price ratio in bps (0 = no confidence check). */\n  confFilterBps: number;\n}\n\nexport function encodeSetPythOracle(args: SetPythOracleArgs): Uint8Array {\n  if (args.feedId.length !== 32) throw new Error('feedId must be 32 bytes');\n  if (args.maxStalenessSecs <= 0n) throw new Error('maxStalenessSecs must be > 0');\n\n  const buf = new Uint8Array(43);\n  const dv = new DataView(buf.buffer);\n\n  // Tag 32 (SetPythOracle)\n  buf[0] = 32;\n  buf.set(args.feedId, 1);\n  dv.setBigUint64(33, args.maxStalenessSecs, /* little-endian */ true);\n  dv.setUint16(41, args.confFilterBps, true);\n\n  return buf;\n}\n\n/**\n * Derive the expected Pyth PriceUpdateV2 account address for a given feed ID.\n * Uses PDA seeds: [shard_id(2), feed_id(32)] under the Pyth Receiver program.\n *\n * @param feedId  32-byte Pyth feed ID\n * @param shardId Shard index (default 0 for mainnet/devnet)\n */\nexport const PYTH_RECEIVER_PROGRAM_ID = 'rec5EKMGg6MxZYaMdyBfgwp4d5rB9T1VQH5pJv5LtFJ';\n\nexport async function derivePythPriceUpdateAccount(\n  feedId: Uint8Array,\n  shardId = 0,\n): Promise<string> {\n  const { PublicKey } = await import('@solana/web3.js');\n  const shardBuf = new Uint8Array(2);\n  new DataView(shardBuf.buffer).setUint16(0, shardId, true);\n  const [pda] = PublicKey.findProgramAddressSync(\n    [shardBuf, feedId],\n    new PublicKey(PYTH_RECEIVER_PROGRAM_ID),\n  );\n  return pda.toBase58();\n}\n\n// Add SetPythOracle to the tag registry\n(IX_TAG as Record<string, number>)['SetPythOracle'] = 32;\n\n// PERC-118: Mark Price EMA Instructions\n// ============================================================================\n\n// Tag 33 — permissionless mark price EMA crank\n(IX_TAG as Record<string, number>)['UpdateMarkPrice'] = 33;\n\n/**\n * UpdateMarkPrice (Tag 33) — permissionless EMA mark price crank.\n *\n * Reads the current oracle price on-chain, applies 8-hour EMA smoothing\n * with circuit breaker, and writes result to authority_price_e6.\n *\n * Instruction data: 1 byte (tag only — all params read from on-chain state)\n *\n * Accounts:\n *   0. [writable] Slab\n *   1. []         Oracle account (Pyth PriceUpdateV2 / Chainlink / DEX AMM)\n *   2. []         Clock sysvar (SysvarC1ock11111111111111111111111111111111)\n *   3..N []       Remaining accounts (PumpSwap vaults, etc. if needed)\n */\nexport function encodeUpdateMarkPrice(): Uint8Array {\n  return new Uint8Array([33]);\n}\n\n/**\n * Mark price EMA parameters (must match program/src/percolator.rs constants).\n */\nexport const MARK_PRICE_EMA_WINDOW_SLOTS = 72_000n;\nexport const MARK_PRICE_EMA_ALPHA_E6 = 2_000_000n / (MARK_PRICE_EMA_WINDOW_SLOTS + 1n);\n\n/**\n * Compute the next EMA mark price step (TypeScript mirror of the on-chain function).\n */\nexport function computeEmaMarkPrice(\n  markPrevE6: bigint,\n  oracleE6: bigint,\n  dtSlots: bigint,\n  alphaE6 = MARK_PRICE_EMA_ALPHA_E6,\n  capE2bps = 0n,\n): bigint {\n  if (oracleE6 === 0n) return markPrevE6;\n  if (markPrevE6 === 0n || dtSlots === 0n) return oracleE6;\n\n  let oracleClamped = oracleE6;\n  if (capE2bps > 0n) {\n    const maxDelta = (markPrevE6 * capE2bps * dtSlots) / 1_000_000n;\n    const lo = markPrevE6 > maxDelta ? markPrevE6 - maxDelta : 0n;\n    const hi = markPrevE6 + maxDelta;\n    if (oracleClamped < lo) oracleClamped = lo;\n    if (oracleClamped > hi) oracleClamped = hi;\n  }\n\n  const effectiveAlpha = alphaE6 * dtSlots > 1_000_000n ? 1_000_000n : alphaE6 * dtSlots;\n  const oneMinusAlpha = 1_000_000n - effectiveAlpha;\n\n  return (oracleClamped * effectiveAlpha + markPrevE6 * oneMinusAlpha) / 1_000_000n;\n}\n\n// PERC-119: Hyperp EMA Oracle for Permissionless Tokens\n// ============================================================================\n\n// Tag 34 — permissionless Hyperp mark price oracle (reads DEX AMM pool)\n(IX_TAG as Record<string, number>)['UpdateHyperpMark'] = 34;\n\n/**\n * UpdateHyperpMark (Tag 34) — permissionless Hyperp EMA oracle crank.\n *\n * Reads the spot price from a PumpSwap, Raydium CLMM, or Meteora DLMM pool,\n * applies 8-hour EMA smoothing with circuit breaker, and writes the new mark\n * to authority_price_e6 on the slab.\n *\n * This is the core mechanism for permissionless token markets — no Pyth or\n * Chainlink feed is needed. The DEX AMM IS the oracle.\n *\n * Instruction data: 1 byte (tag only)\n *\n * Accounts:\n *   0. [writable] Slab\n *   1. []         DEX pool account (PumpSwap / Raydium CLMM / Meteora DLMM)\n *   2. []         Clock sysvar (SysvarC1ock11111111111111111111111111111111)\n *   3..N []       Remaining accounts (e.g. PumpSwap vault0 + vault1)\n */\nexport function encodeUpdateHyperpMark(): Uint8Array {\n  return new Uint8Array([34]);\n}\n\n// ============================================================================\n// SMART PRICE ROUTER — quote computation for LP selection\n// ============================================================================\n\n/**\n * Parsed vAMM matcher parameters (from on-chain matcher context account)\n */\nexport interface VammMatcherParams {\n  mode: number;                    // 0 = Passive, 1 = vAMM\n  tradingFeeBps: number;\n  baseSpreadBps: number;\n  maxTotalBps: number;\n  impactKBps: number;\n  liquidityNotionalE6: bigint;\n}\n\n/** Magic bytes identifying a vAMM matcher context: \"PERCMATC\" as u64 LE */\nexport const VAMM_MAGIC = 0x5045_5243_4d41_5443n;\n\n/** Offset into matcher context where vAMM params start */\nexport const CTX_VAMM_OFFSET = 64;\n\nconst BPS_DENOM = 10_000n;\n\n/**\n * Compute execution price for a given LP quote.\n * For buys (isLong=true): price above oracle.\n * For sells (isLong=false): price below oracle.\n */\nexport function computeVammQuote(\n  params: VammMatcherParams,\n  oraclePriceE6: bigint,\n  tradeSize: bigint,\n  isLong: boolean,\n): bigint {\n  const absSize = tradeSize < 0n ? -tradeSize : tradeSize;\n  const absNotionalE6 = (absSize * oraclePriceE6) / 1_000_000n;\n\n  // Impact for vAMM mode\n  let impactBps = 0n;\n  if (params.mode === 1 && params.liquidityNotionalE6 > 0n) {\n    impactBps = (absNotionalE6 * BigInt(params.impactKBps)) / params.liquidityNotionalE6;\n  }\n\n  // Total = base_spread + trading_fee + impact, capped at max_total\n  const maxTotal = BigInt(params.maxTotalBps);\n  const baseFee = BigInt(params.baseSpreadBps) + BigInt(params.tradingFeeBps);\n  const maxImpact = maxTotal > baseFee ? maxTotal - baseFee : 0n;\n  const clampedImpact = impactBps < maxImpact ? impactBps : maxImpact;\n  let totalBps = baseFee + clampedImpact;\n  if (totalBps > maxTotal) totalBps = maxTotal;\n\n  if (isLong) {\n    return (oraclePriceE6 * (BPS_DENOM + totalBps)) / BPS_DENOM;\n  } else {\n    // Prevent underflow: if totalBps >= BPS_DENOM, price would go negative\n    if (totalBps >= BPS_DENOM) return 1n; // minimum 1 micro-dollar\n    return (oraclePriceE6 * (BPS_DENOM - totalBps)) / BPS_DENOM;\n  }\n}\n","import {\n  PublicKey,\n  AccountMeta,\n  SYSVAR_CLOCK_PUBKEY,\n  SYSVAR_RENT_PUBKEY,\n  SystemProgram,\n} from \"@solana/web3.js\";\nimport { TOKEN_PROGRAM_ID } from \"@solana/spl-token\";\n\n/**\n * Account spec for building instruction account metas.\n * Each instruction has a fixed ordering that matches the Rust processor.\n */\nexport interface AccountSpec {\n  name: string;\n  signer: boolean;\n  writable: boolean;\n}\n\n// ============================================================================\n// ACCOUNT ORDERINGS - Single source of truth\n// ============================================================================\n\n/**\n * InitMarket: 9 accounts (Pyth Pull - feed_id is in instruction data, not as accounts)\n */\nexport const ACCOUNTS_INIT_MARKET: readonly AccountSpec[] = [\n  { name: \"admin\", signer: true, writable: true },\n  { name: \"slab\", signer: false, writable: true },\n  { name: \"mint\", signer: false, writable: false },\n  { name: \"vault\", signer: false, writable: false },\n  { name: \"tokenProgram\", signer: false, writable: false },\n  { name: \"clock\", signer: false, writable: false },\n  { name: \"rent\", signer: false, writable: false },\n  { name: \"dummyAta\", signer: false, writable: false },\n  { name: \"systemProgram\", signer: false, writable: false },\n] as const;\n\n/**\n * InitUser: 5 accounts (clock/oracle removed in commit 410f947)\n */\nexport const ACCOUNTS_INIT_USER: readonly AccountSpec[] = [\n  { name: \"user\", signer: true, writable: true },\n  { name: \"slab\", signer: false, writable: true },\n  { name: \"userAta\", signer: false, writable: true },\n  { name: \"vault\", signer: false, writable: true },\n  { name: \"tokenProgram\", signer: false, writable: false },\n] as const;\n\n/**\n * InitLP: 5 accounts (clock/oracle removed in commit 410f947)\n */\nexport const ACCOUNTS_INIT_LP: readonly AccountSpec[] = [\n  { name: \"user\", signer: true, writable: true },\n  { name: \"slab\", signer: false, writable: true },\n  { name: \"userAta\", signer: false, writable: true },\n  { name: \"vault\", signer: false, writable: true },\n  { name: \"tokenProgram\", signer: false, writable: false },\n] as const;\n\n/**\n * DepositCollateral: 6 accounts\n */\nexport const ACCOUNTS_DEPOSIT_COLLATERAL: readonly AccountSpec[] = [\n  { name: \"user\", signer: true, writable: true },\n  { name: \"slab\", signer: false, writable: true },\n  { name: \"userAta\", signer: false, writable: true },\n  { name: \"vault\", signer: false, writable: true },\n  { name: \"tokenProgram\", signer: false, writable: false },\n  { name: \"clock\", signer: false, writable: false },\n] as const;\n\n/**\n * WithdrawCollateral: 8 accounts\n */\nexport const ACCOUNTS_WITHDRAW_COLLATERAL: readonly AccountSpec[] = [\n  { name: \"user\", signer: true, writable: true },\n  { name: \"slab\", signer: false, writable: true },\n  { name: \"vault\", signer: false, writable: true },\n  { name: \"userAta\", signer: false, writable: true },\n  { name: \"vaultPda\", signer: false, writable: false },\n  { name: \"tokenProgram\", signer: false, writable: false },\n  { name: \"clock\", signer: false, writable: false },\n  { name: \"oracleIdx\", signer: false, writable: false },\n] as const;\n\n/**\n * KeeperCrank: 4 accounts\n */\nexport const ACCOUNTS_KEEPER_CRANK: readonly AccountSpec[] = [\n  { name: \"caller\", signer: true, writable: true },\n  { name: \"slab\", signer: false, writable: true },\n  { name: \"clock\", signer: false, writable: false },\n  { name: \"oracle\", signer: false, writable: false },\n] as const;\n\n/**\n * TradeNoCpi: 5 accounts\n */\nexport const ACCOUNTS_TRADE_NOCPI: readonly AccountSpec[] = [\n  { name: \"user\", signer: true, writable: true },\n  { name: \"lp\", signer: true, writable: true },\n  { name: \"slab\", signer: false, writable: true },\n  { name: \"clock\", signer: false, writable: false },\n  { name: \"oracle\", signer: false, writable: false },\n] as const;\n\n/**\n * LiquidateAtOracle: 4 accounts\n * Note: account[0] is unused but must be present\n */\nexport const ACCOUNTS_LIQUIDATE_AT_ORACLE: readonly AccountSpec[] = [\n  { name: \"unused\", signer: false, writable: false },\n  { name: \"slab\", signer: false, writable: true },\n  { name: \"clock\", signer: false, writable: false },\n  { name: \"oracle\", signer: false, writable: false },\n] as const;\n\n/**\n * CloseAccount: 8 accounts\n */\nexport const ACCOUNTS_CLOSE_ACCOUNT: readonly AccountSpec[] = [\n  { name: \"user\", signer: true, writable: true },\n  { name: \"slab\", signer: false, writable: true },\n  { name: \"vault\", signer: false, writable: true },\n  { name: \"userAta\", signer: false, writable: true },\n  { name: \"vaultPda\", signer: false, writable: false },\n  { name: \"tokenProgram\", signer: false, writable: false },\n  { name: \"clock\", signer: false, writable: false },\n  { name: \"oracle\", signer: false, writable: false },\n] as const;\n\n/**\n * TopUpInsurance: 5 accounts\n */\nexport const ACCOUNTS_TOPUP_INSURANCE: readonly AccountSpec[] = [\n  { name: \"user\", signer: true, writable: true },\n  { name: \"slab\", signer: false, writable: true },\n  { name: \"userAta\", signer: false, writable: true },\n  { name: \"vault\", signer: false, writable: true },\n  { name: \"tokenProgram\", signer: false, writable: false },\n] as const;\n\n/**\n * TradeCpi: 8 accounts\n */\nexport const ACCOUNTS_TRADE_CPI: readonly AccountSpec[] = [\n  { name: \"user\", signer: true, writable: true },\n  { name: \"lpOwner\", signer: false, writable: false },  // LP delegated to matcher - no signature needed\n  { name: \"slab\", signer: false, writable: true },\n  { name: \"clock\", signer: false, writable: false },\n  { name: \"oracle\", signer: false, writable: false },\n  { name: \"matcherProg\", signer: false, writable: false },\n  { name: \"matcherCtx\", signer: false, writable: true },\n  { name: \"lpPda\", signer: false, writable: false },\n] as const;\n\n/**\n * SetRiskThreshold: 2 accounts\n */\nexport const ACCOUNTS_SET_RISK_THRESHOLD: readonly AccountSpec[] = [\n  { name: \"admin\", signer: true, writable: true },\n  { name: \"slab\", signer: false, writable: true },\n] as const;\n\n/**\n * UpdateAdmin: 2 accounts\n */\nexport const ACCOUNTS_UPDATE_ADMIN: readonly AccountSpec[] = [\n  { name: \"admin\", signer: true, writable: true },\n  { name: \"slab\", signer: false, writable: true },\n] as const;\n\n/**\n * CloseSlab: 2 accounts\n */\nexport const ACCOUNTS_CLOSE_SLAB: readonly AccountSpec[] = [\n  { name: \"admin\", signer: true, writable: true },\n  { name: \"slab\", signer: false, writable: true },\n] as const;\n\n/**\n * UpdateConfig: 2 accounts\n */\nexport const ACCOUNTS_UPDATE_CONFIG: readonly AccountSpec[] = [\n  { name: \"admin\", signer: true, writable: true },\n  { name: \"slab\", signer: false, writable: true },\n] as const;\n\n/**\n * SetMaintenanceFee: 2 accounts\n */\nexport const ACCOUNTS_SET_MAINTENANCE_FEE: readonly AccountSpec[] = [\n  { name: \"admin\", signer: true, writable: true },\n  { name: \"slab\", signer: false, writable: true },\n] as const;\n\n/**\n * SetOracleAuthority: 2 accounts\n * Sets the oracle price authority (admin only)\n */\nexport const ACCOUNTS_SET_ORACLE_AUTHORITY: readonly AccountSpec[] = [\n  { name: \"admin\", signer: true, writable: true },\n  { name: \"slab\", signer: false, writable: true },\n] as const;\n\n/**\n * PushOraclePrice: 2 accounts\n * Push oracle price (oracle authority only)\n */\nexport const ACCOUNTS_PUSH_ORACLE_PRICE: readonly AccountSpec[] = [\n  { name: \"authority\", signer: true, writable: true },\n  { name: \"slab\", signer: false, writable: true },\n] as const;\n\n/**\n * ResolveMarket: 2 accounts\n * Resolves a binary/premarket (admin only)\n */\nexport const ACCOUNTS_RESOLVE_MARKET: readonly AccountSpec[] = [\n  { name: \"admin\", signer: true, writable: true },\n  { name: \"slab\", signer: false, writable: true },\n] as const;\n\n/**\n * WithdrawInsurance: 6 accounts\n * Withdraw insurance fund after market resolution (admin only)\n */\nexport const ACCOUNTS_WITHDRAW_INSURANCE: readonly AccountSpec[] = [\n  { name: \"admin\", signer: true, writable: true },\n  { name: \"slab\", signer: false, writable: true },\n  { name: \"adminAta\", signer: false, writable: true },\n  { name: \"vault\", signer: false, writable: true },\n  { name: \"tokenProgram\", signer: false, writable: false },\n  { name: \"vaultPda\", signer: false, writable: false },\n] as const;\n\n/**\n * PauseMarket: 2 accounts\n */\nexport const ACCOUNTS_PAUSE_MARKET: readonly AccountSpec[] = [\n  { name: \"admin\", signer: true, writable: true },\n  { name: \"slab\", signer: false, writable: true },\n] as const;\n\n/**\n * UnpauseMarket: 2 accounts\n */\nexport const ACCOUNTS_UNPAUSE_MARKET: readonly AccountSpec[] = [\n  { name: \"admin\", signer: true, writable: true },\n  { name: \"slab\", signer: false, writable: true },\n] as const;\n\n// ============================================================================\n// ACCOUNT META BUILDERS\n// ============================================================================\n\n/**\n * Build AccountMeta array from spec and provided pubkeys.\n * Keys must be provided in the same order as the spec.\n */\nexport function buildAccountMetas(\n  spec: readonly AccountSpec[],\n  keys: PublicKey[]\n): AccountMeta[] {\n  if (keys.length !== spec.length) {\n    throw new Error(\n      `Account count mismatch: expected ${spec.length}, got ${keys.length}`\n    );\n  }\n  return spec.map((s, i) => ({\n    pubkey: keys[i],\n    isSigner: s.signer,\n    isWritable: s.writable,\n  }));\n}\n\n/**\n * CreateInsuranceMint: 9 accounts\n * Creates SPL mint PDA for insurance LP tokens. Admin only, once per market.\n */\nexport const ACCOUNTS_CREATE_INSURANCE_MINT: readonly AccountSpec[] = [\n  { name: \"admin\", signer: true, writable: false },\n  { name: \"slab\", signer: false, writable: false },\n  { name: \"insLpMint\", signer: false, writable: true },\n  { name: \"vaultAuthority\", signer: false, writable: false },\n  { name: \"collateralMint\", signer: false, writable: false },\n  { name: \"systemProgram\", signer: false, writable: false },\n  { name: \"tokenProgram\", signer: false, writable: false },\n  { name: \"rent\", signer: false, writable: false },\n  { name: \"payer\", signer: true, writable: true },\n] as const;\n\n/**\n * DepositInsuranceLP: 8 accounts\n * Deposit collateral into insurance fund, receive LP tokens.\n */\nexport const ACCOUNTS_DEPOSIT_INSURANCE_LP: readonly AccountSpec[] = [\n  { name: \"depositor\", signer: true, writable: false },\n  { name: \"slab\", signer: false, writable: true },\n  { name: \"depositorAta\", signer: false, writable: true },\n  { name: \"vault\", signer: false, writable: true },\n  { name: \"tokenProgram\", signer: false, writable: false },\n  { name: \"insLpMint\", signer: false, writable: true },\n  { name: \"depositorLpAta\", signer: false, writable: true },\n  { name: \"vaultAuthority\", signer: false, writable: false },\n] as const;\n\n/**\n * WithdrawInsuranceLP: 8 accounts\n * Burn LP tokens and withdraw proportional share of insurance fund.\n */\nexport const ACCOUNTS_WITHDRAW_INSURANCE_LP: readonly AccountSpec[] = [\n  { name: \"withdrawer\", signer: true, writable: false },\n  { name: \"slab\", signer: false, writable: true },\n  { name: \"withdrawerAta\", signer: false, writable: true },\n  { name: \"vault\", signer: false, writable: true },\n  { name: \"tokenProgram\", signer: false, writable: false },\n  { name: \"insLpMint\", signer: false, writable: true },\n  { name: \"withdrawerLpAta\", signer: false, writable: true },\n  { name: \"vaultAuthority\", signer: false, writable: false },\n] as const;\n\n// ============================================================================\n// WELL-KNOWN PROGRAM/SYSVAR KEYS\n// ============================================================================\n\nexport const WELL_KNOWN = {\n  tokenProgram: TOKEN_PROGRAM_ID,\n  clock: SYSVAR_CLOCK_PUBKEY,\n  rent: SYSVAR_RENT_PUBKEY,\n  systemProgram: SystemProgram.programId,\n} as const;\n","/**\n * Percolator program error definitions.\n * Each error includes a name and actionable guidance.\n */\ninterface ErrorInfo {\n  name: string;\n  hint: string;\n}\n\nexport const PERCOLATOR_ERRORS: Record<number, ErrorInfo> = {\n  0: {\n    name: \"InvalidMagic\",\n    hint: \"The slab account has invalid data. Ensure you're using the correct slab address.\",\n  },\n  1: {\n    name: \"InvalidVersion\",\n    hint: \"Slab version mismatch. The program may have been upgraded. Check for CLI updates.\",\n  },\n  2: {\n    name: \"AlreadyInitialized\",\n    hint: \"This account is already initialized. Use a different account or skip initialization.\",\n  },\n  3: {\n    name: \"NotInitialized\",\n    hint: \"The slab is not initialized. Run 'init-market' first.\",\n  },\n  4: {\n    name: \"InvalidSlabLen\",\n    hint: \"Slab account has wrong size. Create a new slab account with correct size.\",\n  },\n  5: {\n    name: \"InvalidOracleKey\",\n    hint: \"Oracle account doesn't match config. Check the --oracle parameter matches the market's oracle.\",\n  },\n  6: {\n    name: \"OracleStale\",\n    hint: \"Oracle price is too old. Wait for oracle to update or check if oracle is paused.\",\n  },\n  7: {\n    name: \"OracleConfTooWide\",\n    hint: \"Oracle confidence interval is too wide. Wait for more stable market conditions.\",\n  },\n  8: {\n    name: \"InvalidVaultAta\",\n    hint: \"Vault token account is invalid. Check the vault account is correctly configured.\",\n  },\n  9: {\n    name: \"InvalidMint\",\n    hint: \"Token mint doesn't match. Ensure you're using the correct collateral token.\",\n  },\n  10: {\n    name: \"ExpectedSigner\",\n    hint: \"Missing required signature. Ensure the correct wallet is specified with --wallet.\",\n  },\n  11: {\n    name: \"ExpectedWritable\",\n    hint: \"Account must be writable. This is likely a CLI bug - please report it.\",\n  },\n  12: {\n    name: \"OracleInvalid\",\n    hint: \"Oracle data is invalid. Check the oracle account is a valid Pyth price feed.\",\n  },\n  13: {\n    name: \"EngineInsufficientBalance\",\n    hint: \"Not enough collateral. Deposit more with 'deposit' before this operation.\",\n  },\n  14: {\n    name: \"EngineUndercollateralized\",\n    hint: \"Account is undercollateralized. Deposit more collateral or reduce position size.\",\n  },\n  15: {\n    name: \"EngineUnauthorized\",\n    hint: \"Not authorized. You must be the account owner or admin for this operation.\",\n  },\n  16: {\n    name: \"EngineInvalidMatchingEngine\",\n    hint: \"Matcher program/context doesn't match LP config. Check --matcher-program and --matcher-context.\",\n  },\n  17: {\n    name: \"EnginePnlNotWarmedUp\",\n    hint: \"PnL not warmed up yet. Wait for the warmup period to complete before trading.\",\n  },\n  18: {\n    name: \"EngineOverflow\",\n    hint: \"Numeric overflow in calculation. Try a smaller amount or position size.\",\n  },\n  19: {\n    name: \"EngineAccountNotFound\",\n    hint: \"Account not found at this index. Run 'init-user' or 'init-lp' first, or check the index.\",\n  },\n  20: {\n    name: \"EngineNotAnLPAccount\",\n    hint: \"Expected an LP account but got a user account. Check the --lp-idx parameter.\",\n  },\n  21: {\n    name: \"EnginePositionSizeMismatch\",\n    hint: \"Position size mismatch between user and LP. This shouldn't happen - please report it.\",\n  },\n  22: {\n    name: \"EngineRiskReductionOnlyMode\",\n    hint: \"Market is in risk-reduction mode. Only position-reducing trades are allowed.\",\n  },\n  23: {\n    name: \"EngineAccountKindMismatch\",\n    hint: \"Wrong account type. User operations require user accounts, LP operations require LP accounts.\",\n  },\n  24: {\n    name: \"InvalidTokenAccount\",\n    hint: \"Token account is invalid. Ensure you have an ATA for the collateral mint.\",\n  },\n  25: {\n    name: \"InvalidTokenProgram\",\n    hint: \"Invalid token program. Ensure SPL Token program is accessible.\",\n  },\n  26: {\n    name: \"InvalidConfigParam\",\n    hint: \"Invalid configuration parameter. Check that leverage, fees, and risk thresholds are within allowed ranges.\",\n  },\n  27: {\n    name: \"HyperpTradeNoCpiDisabled\",\n    hint: \"TradeNoCpi is disabled for this market. Use TradeCpi with LP matching instead.\",\n  },\n  28: {\n    name: \"InsuranceMintAlreadyExists\",\n    hint: \"Insurance LP mint already exists for this market. Cannot recreate.\",\n  },\n  29: {\n    name: \"InsuranceMintNotCreated\",\n    hint: \"Insurance LP mint has not been created yet. Run CreateInsuranceMint first.\",\n  },\n  30: {\n    name: \"InsuranceBelowThreshold\",\n    hint: \"Insurance fund balance is below the required threshold. Deposit more to insurance fund.\",\n  },\n  31: {\n    name: \"InsuranceZeroAmount\",\n    hint: \"Insurance deposit/withdrawal amount must be greater than zero.\",\n  },\n  32: {\n    name: \"InsuranceSupplyMismatch\",\n    hint: \"Insurance LP token supply doesn't match vault balance. This is an internal error - please report it.\",\n  },\n  33: {\n    name: \"MarketPaused\",\n    hint: \"This market is currently paused by the admin. Trading, deposits, and withdrawals are disabled.\",\n  },\n};\n\n/**\n * Decode a custom program error code to its info.\n */\nexport function decodeError(code: number): ErrorInfo | undefined {\n  return PERCOLATOR_ERRORS[code];\n}\n\n/**\n * Get error name from code.\n */\nexport function getErrorName(code: number): string {\n  return PERCOLATOR_ERRORS[code]?.name ?? `Unknown(${code})`;\n}\n\n/**\n * Get actionable hint for error code.\n */\nexport function getErrorHint(code: number): string | undefined {\n  return PERCOLATOR_ERRORS[code]?.hint;\n}\n\n/**\n * Parse error from transaction logs.\n * Looks for \"Program ... failed: custom program error: 0x...\"\n */\nexport function parseErrorFromLogs(logs: string[]): {\n  code: number;\n  name: string;\n  hint?: string;\n} | null {\n  for (const log of logs) {\n    const match = log.match(/custom program error: 0x([0-9a-fA-F]+)/);\n    if (match) {\n      const code = parseInt(match[1], 16);\n      const info = decodeError(code);\n      return {\n        code,\n        name: info?.name ?? `Unknown(${code})`,\n        hint: info?.hint,\n      };\n    }\n  }\n  return null;\n}\n","import { Connection, PublicKey } from \"@solana/web3.js\";\n\n// =============================================================================\n// Browser-compatible read helpers using DataView\n// (the npm 'buffer' polyfill lacks readBigUInt64LE / readBigInt64LE)\n// =============================================================================\nfunction dv(data: Uint8Array): DataView {\n  return new DataView(data.buffer, data.byteOffset, data.byteLength);\n}\nfunction readU8(data: Uint8Array, off: number): number {\n  return data[off];\n}\nfunction readU16LE(data: Uint8Array, off: number): number {\n  return dv(data).getUint16(off, true);\n}\nfunction readU32LE(data: Uint8Array, off: number): number {\n  return dv(data).getUint32(off, true);\n}\nfunction readU64LE(data: Uint8Array, off: number): bigint {\n  return dv(data).getBigUint64(off, true);\n}\nfunction readI64LE(data: Uint8Array, off: number): bigint {\n  return dv(data).getBigInt64(off, true);\n}\n\n// Constants from Rust (updated for PERC-120/121/122 struct changes 2026-02)\nconst MAGIC: bigint = 0x504552434f4c4154n; // \"PERCOLAT\"\n// SlabHeader: magic(8) + version(4) + bump(1) + _padding(3) + admin(32) + pending_admin(32) + _reserved(24) = 104\nconst HEADER_LEN = 104;\nconst CONFIG_OFFSET = HEADER_LEN;  // MarketConfig starts right after header\n// MarketConfig: collateral_mint(32) + vault_pubkey(32) + index_feed_id(32) + max_staleness_secs(8) +\n//               conf_filter_bps(2) + bump(1) + invert(1) + unit_scale(4) +\n//               funding_horizon_slots(8) + funding_k_bps(8) + funding_inv_scale_notional_e6(16) +\n//               funding_max_premium_bps(8) + funding_max_bps_per_slot(8) +\n//               funding_premium_weight_bps(8) + funding_settlement_interval_slots(8) +\n//               funding_premium_dampening_e6(8) + funding_premium_max_bps_per_slot(8) +\n//               thresh_floor(16) + thresh_risk_bps(8) + thresh_update_interval_slots(8) +\n//               thresh_step_bps(8) + thresh_alpha_bps(8) + thresh_min(16) + thresh_max(16) + thresh_min_step(16) +\n//               oracle_authority(32) + authority_price_e6(8) + authority_timestamp(8) +\n//               oracle_price_cap_e2bps(8) + last_effective_price_e6(8)\n//             = 352 bytes\nconst CONFIG_LEN = 352;\n// Offset of _reserved field within SlabHeader (magic+version+bump+_padding+admin+pending_admin = 80)\nconst RESERVED_OFF = 80;\n\n// Flag bits in header._padding[0] at offset 13\nconst FLAG_RESOLVED = 1 << 0;\n\n/**\n * Slab header (72 bytes)\n */\nexport interface SlabHeader {\n  magic: bigint;\n  version: number;\n  bump: number;\n  flags: number;\n  resolved: boolean;\n  paused: boolean;\n  admin: PublicKey;\n  nonce: bigint;\n  lastThrUpdateSlot: bigint;\n}\n\n/**\n * Market config (starts at offset 72)\n * Layout: collateral_mint(32) + vault_pubkey(32) + index_feed_id(32)\n *         + max_staleness_secs(8) + conf_filter_bps(2) + vault_authority_bump(1) + invert(1) + unit_scale(4)\n */\nexport interface MarketConfig {\n  collateralMint: PublicKey;\n  vaultPubkey: PublicKey;\n  indexFeedId: PublicKey;       // index_feed_id (Pyth feed ID stored as 32 bytes)\n  maxStalenessSlots: bigint;    // max_staleness_secs\n  confFilterBps: number;\n  vaultAuthorityBump: number;\n  invert: number;               // 0 = no inversion, 1 = invert oracle price\n  unitScale: number;            // Lamports per unit (0 = no scaling)\n  // Funding rate parameters\n  fundingHorizonSlots: bigint;\n  fundingKBps: bigint;\n  fundingInvScaleNotionalE6: bigint;\n  fundingMaxPremiumBps: bigint;\n  fundingMaxBpsPerSlot: bigint;\n  // Threshold parameters\n  threshFloor: bigint;\n  threshRiskBps: bigint;\n  threshUpdateIntervalSlots: bigint;\n  threshStepBps: bigint;\n  threshAlphaBps: bigint;\n  threshMin: bigint;\n  threshMax: bigint;\n  threshMinStep: bigint;\n  // Oracle authority\n  oracleAuthority: PublicKey;\n  authorityPriceE6: bigint;\n  authorityTimestamp: bigint;\n  // Oracle price circuit breaker\n  oraclePriceCapE2bps: bigint;\n  lastEffectivePriceE6: bigint;\n}\n\n/**\n * Fetch raw slab account data.\n */\nexport async function fetchSlab(\n  connection: Connection,\n  slabPubkey: PublicKey\n): Promise<Uint8Array> {\n  const info = await connection.getAccountInfo(slabPubkey);\n  if (!info) {\n    throw new Error(`Slab account not found: ${slabPubkey.toBase58()}`);\n  }\n  return new Uint8Array(info.data);\n}\n\n/**\n * Parse slab header (first 64 bytes).\n */\nexport function parseHeader(data: Uint8Array): SlabHeader {\n  if (data.length < HEADER_LEN) {\n    throw new Error(`Slab data too short for header: ${data.length} < ${HEADER_LEN}`);\n  }\n\n  const magic = readU64LE(data, 0);\n  if (magic !== MAGIC) {\n    throw new Error(`Invalid slab magic: expected ${MAGIC.toString(16)}, got ${magic.toString(16)}`);\n  }\n\n  const version = readU32LE(data, 8);\n  const bump = readU8(data, 12);\n  const flags = readU8(data, 13);  // _padding[0] contains flags\n  const admin = new PublicKey(data.subarray(16, 48));\n\n  // Reserved field: nonce at [0..8], lastThrUpdateSlot at [8..16]\n  const nonce = readU64LE(data, RESERVED_OFF);\n  const lastThrUpdateSlot = readU64LE(data, RESERVED_OFF + 8);\n\n  return {\n    magic,\n    version,\n    bump,\n    flags,\n    resolved: (flags & FLAG_RESOLVED) !== 0,\n    paused: (flags & 0x02) !== 0,\n    admin,\n    nonce,\n    lastThrUpdateSlot,\n  };\n}\n\n/**\n * Parse market config (starts at byte 72).\n * Layout: collateral_mint(32) + vault_pubkey(32) + index_feed_id(32)\n *         + max_staleness_secs(8) + conf_filter_bps(2) + vault_authority_bump(1) + invert(1) + unit_scale(4)\n */\nexport function parseConfig(data: Uint8Array): MarketConfig {\n  const minLen = CONFIG_OFFSET + CONFIG_LEN;\n  if (data.length < minLen) {\n    throw new Error(`Slab data too short for config: ${data.length} < ${minLen}`);\n  }\n\n  let off = CONFIG_OFFSET;\n\n  const collateralMint = new PublicKey(data.subarray(off, off + 32));\n  off += 32;\n\n  const vaultPubkey = new PublicKey(data.subarray(off, off + 32));\n  off += 32;\n\n  // index_feed_id (32 bytes) - Pyth feed ID, stored as 32 bytes\n  const indexFeedId = new PublicKey(data.subarray(off, off + 32));\n  off += 32;\n\n  const maxStalenessSlots = readU64LE(data, off);\n  off += 8;\n\n  const confFilterBps = readU16LE(data, off);\n  off += 2;\n\n  const vaultAuthorityBump = readU8(data, off);\n  off += 1;\n\n  const invert = readU8(data, off);\n  off += 1;\n\n  const unitScale = readU32LE(data, off);\n  off += 4;\n\n  // Funding rate parameters\n  const fundingHorizonSlots = readU64LE(data, off);\n  off += 8;\n\n  const fundingKBps = readU64LE(data, off);\n  off += 8;\n\n  const fundingInvScaleNotionalE6 = readU128LE(data, off); // Rust: u128\n  off += 16;\n\n  const fundingMaxPremiumBps = readI64LE(data, off); // Rust: i64\n  off += 8;\n\n  const fundingMaxBpsPerSlot = readI64LE(data, off); // Rust: i64\n  off += 8;\n\n  // Threshold parameters\n  const threshFloor = readU128LE(data, off);\n  off += 16;\n\n  const threshRiskBps = readU64LE(data, off);\n  off += 8;\n\n  const threshUpdateIntervalSlots = readU64LE(data, off);\n  off += 8;\n\n  const threshStepBps = readU64LE(data, off);\n  off += 8;\n\n  const threshAlphaBps = readU64LE(data, off);\n  off += 8;\n\n  const threshMin = readU128LE(data, off);\n  off += 16;\n\n  const threshMax = readU128LE(data, off);\n  off += 16;\n\n  const threshMinStep = readU128LE(data, off);\n  off += 16;\n\n  // Oracle authority fields\n  const oracleAuthority = new PublicKey(data.subarray(off, off + 32));\n  off += 32;\n\n  const authorityPriceE6 = readU64LE(data, off);\n  off += 8;\n\n  const authorityTimestamp = readI64LE(data, off);\n  off += 8;\n\n  // Oracle price circuit breaker\n  const oraclePriceCapE2bps = readU64LE(data, off);\n  off += 8;\n\n  const lastEffectivePriceE6 = readU64LE(data, off);\n\n  return {\n    collateralMint,\n    vaultPubkey,\n    indexFeedId,\n    maxStalenessSlots,\n    confFilterBps,\n    vaultAuthorityBump,\n    invert,\n    unitScale,\n    fundingHorizonSlots,\n    fundingKBps,\n    fundingInvScaleNotionalE6,\n    fundingMaxPremiumBps,\n    fundingMaxBpsPerSlot,\n    threshFloor,\n    threshRiskBps,\n    threshUpdateIntervalSlots,\n    threshStepBps,\n    threshAlphaBps,\n    threshMin,\n    threshMax,\n    threshMinStep,\n    oracleAuthority,\n    authorityPriceE6,\n    authorityTimestamp,\n    oraclePriceCapE2bps,\n    lastEffectivePriceE6,\n  };\n}\n\n/**\n * Read nonce from slab header reserved field.\n */\nexport function readNonce(data: Uint8Array): bigint {\n  if (data.length < RESERVED_OFF + 8) {\n    throw new Error(\"Slab data too short for nonce\");\n  }\n  return readU64LE(data, RESERVED_OFF);\n}\n\n/**\n * Read last threshold update slot from slab header reserved field.\n */\nexport function readLastThrUpdateSlot(data: Uint8Array): bigint {\n  if (data.length < RESERVED_OFF + 16) {\n    throw new Error(\"Slab data too short for lastThrUpdateSlot\");\n  }\n  return readU64LE(data, RESERVED_OFF + 8);\n}\n\n// =============================================================================\n// RiskEngine Layout Constants (updated for PERC-120/121/122 struct changes 2026-02)\n// ENGINE_OFF = align_up(HEADER_LEN + CONFIG_LEN, 8) = align_up(104 + 352, 8) = 456\n//\n// RiskParams grew from 144 → 288 bytes (added: premium funding, partial liq, dynamic fees).\n// Account grew from 240 → 248 bytes (added: last_partial_liquidation_slot).\n// SlabHeader grew from 72 → 104 bytes (added: pending_admin).\n// MarketConfig grew from 320 → 352 bytes (added: premium funding config fields).\n// =============================================================================\nconst ENGINE_OFF = 456;\n// RiskEngine struct layout (repr(C), SBF uses 8-byte alignment for u128):\n// - vault: U128 (16 bytes) at offset 0\n// - insurance_fund: InsuranceFund { balance: U128, fee_revenue: U128 } (32 bytes) at offset 16\n// - params: RiskParams (288 bytes) at offset 48\nconst ENGINE_VAULT_OFF = 0;\nconst ENGINE_INSURANCE_OFF = 16;\nconst ENGINE_PARAMS_OFF = 48;         // RiskParams starts here (after vault+insurance_fund)\n// After RiskParams (at engine offset 48 + 288 = 336):\nconst ENGINE_CURRENT_SLOT_OFF = 336;\nconst ENGINE_FUNDING_INDEX_OFF = 344;   // I128 (16 bytes)\nconst ENGINE_LAST_FUNDING_SLOT_OFF = 360;\nconst ENGINE_FUNDING_RATE_BPS_OFF = 368;// i64: funding_rate_bps_per_slot_last (8 bytes)\n// Premium funding state (PERC-121):\nconst ENGINE_MARK_PRICE_OFF = 376;      // u64: mark_price_e6\nconst ENGINE_FUNDING_FROZEN_OFF = 384;  // bool (1 byte + 7 padding)\nconst ENGINE_FROZEN_RATE_OFF = 392;     // i64: funding_frozen_rate_snapshot\n// Keeper crank:\nconst ENGINE_LAST_CRANK_SLOT_OFF = 400;\nconst ENGINE_MAX_CRANK_STALENESS_OFF = 408;\nconst ENGINE_TOTAL_OI_OFF = 416;        // U128 (16 bytes)\nconst ENGINE_C_TOT_OFF = 432;           // U128: sum of all account capital\nconst ENGINE_PNL_POS_TOT_OFF = 448;     // U128: sum of all positive PnL\nconst ENGINE_LIQ_CURSOR_OFF = 464;      // u16\nconst ENGINE_GC_CURSOR_OFF = 466;       // u16\n// 4 bytes padding for u64 alignment\nconst ENGINE_LAST_SWEEP_START_OFF = 472;\nconst ENGINE_LAST_SWEEP_COMPLETE_OFF = 480;\nconst ENGINE_CRANK_CURSOR_OFF = 488;    // u16\nconst ENGINE_SWEEP_START_IDX_OFF = 490; // u16\n// 4 bytes padding for u64 alignment\nconst ENGINE_LIFETIME_LIQUIDATIONS_OFF = 496;\nconst ENGINE_LIFETIME_FORCE_CLOSES_OFF = 504;\n// LP Aggregates for funding rate calculation (PERC-121)\nconst ENGINE_NET_LP_POS_OFF = 512;      // I128\nconst ENGINE_LP_SUM_ABS_OFF = 528;      // U128\nconst ENGINE_LP_MAX_ABS_OFF = 544;      // U128\nconst ENGINE_LP_MAX_ABS_SWEEP_OFF = 560;// U128\n// Bitmap starts at 576\nconst ENGINE_BITMAP_OFF = 576;\n// Dynamic layout helpers — bitmap/accounts offsets depend on maxAccounts\nconst DEFAULT_MAX_ACCOUNTS = 4096;\nconst DEFAULT_BITMAP_WORDS = 64;  // ceil(4096/64)\nconst ACCOUNT_SIZE = 248;  // Account now includes last_partial_liquidation_slot (PERC-122)\n\n// For backward compat, keep large default\n// Large: bitmap(64*8=512) + num_used(2) + pad(6) + next_account_id(8) + free_head(2) + next_free(4096*2=8192) + pad(6) + accounts = 9304 - 576 = ...\n// Actually: engine fixed(576) + bitmap(512) + 18 + 8192 = 9298, align to 8 = 9304\nconst ENGINE_ACCOUNTS_OFF = 9304;       // accounts offset for 4096 variant (within engine)\n\n/**\n * Compute bitmap words and accounts offset for a given maxAccounts.\n * Layout within engine: fixed(576) + bitmap(words*8) + post_bitmap(18) + next_free(N*2) + padding + accounts(N*248)\n * post_bitmap = num_used(u16,2) + pad(6) + next_account_id(u64,8) + free_head(u16,2) = 18\n */\nfunction slabLayout(maxAccounts: number) {\n  const bitmapWords = Math.ceil(maxAccounts / 64);\n  const bitmapBytes = bitmapWords * 8;\n  const postBitmap = 18; // num_used(u16,2) + pad(6) + next_account_id(u64,8) + free_head(u16,2)\n  const nextFreeBytes = maxAccounts * 2;\n  // Align to 8 bytes for Account (SBF: u128 align = 8)\n  const preAccountsLen = ENGINE_BITMAP_OFF + bitmapBytes + postBitmap + nextFreeBytes;\n  const accountsOff = Math.ceil(preAccountsLen / 8) * 8;\n  return { bitmapWords, accountsOff, maxAccounts };\n}\n\n// Detect maxAccounts from slab data length\nexport function detectLayout(dataLen: number) {\n  // Try each known tier\n  for (const n of [64, 256, 1024, 4096]) {\n    const layout = slabLayout(n);\n    const expectedLen = ENGINE_OFF + layout.accountsOff + n * ACCOUNT_SIZE;\n    if (dataLen === expectedLen) return layout;\n  }\n  // Fallback: compute from params (will read maxAccounts from data)\n  return null;\n}\n\n// =============================================================================\n// RiskParams Layout (288 bytes, repr(C) with 8-byte alignment on SBF)\n// Updated for PERC-120 (dynamic fees), PERC-121 (premium funding), PERC-122 (partial liq)\n// =============================================================================\nconst PARAMS_WARMUP_PERIOD_OFF = 0;        // u64\nconst PARAMS_MAINTENANCE_MARGIN_OFF = 8;   // u64\nconst PARAMS_INITIAL_MARGIN_OFF = 16;      // u64\nconst PARAMS_TRADING_FEE_OFF = 24;         // u64\nconst PARAMS_MAX_ACCOUNTS_OFF = 32;        // u64\nconst PARAMS_NEW_ACCOUNT_FEE_OFF = 40;     // U128 (no padding, 8-byte aligned)\nconst PARAMS_RISK_THRESHOLD_OFF = 56;      // U128\nconst PARAMS_MAINTENANCE_FEE_OFF = 72;     // U128\nconst PARAMS_MAX_CRANK_STALENESS_OFF = 88; // u64\nconst PARAMS_LIQUIDATION_FEE_BPS_OFF = 96; // u64\nconst PARAMS_LIQUIDATION_FEE_CAP_OFF = 104;// U128\nconst PARAMS_LIQUIDATION_BUFFER_OFF = 120; // u64\nconst PARAMS_MIN_LIQUIDATION_OFF = 128;    // U128\n// PERC-121: Premium funding params\nconst PARAMS_FUNDING_PREMIUM_WEIGHT_OFF = 144; // u64\nconst PARAMS_FUNDING_SETTLEMENT_OFF = 152;     // u64\nconst PARAMS_FUNDING_DAMPENING_OFF = 160;      // u64\nconst PARAMS_FUNDING_PREMIUM_MAX_OFF = 168;    // i64\n// PERC-122: Partial liquidation params\nconst PARAMS_PARTIAL_LIQ_BPS_OFF = 176;       // u64\nconst PARAMS_PARTIAL_LIQ_COOLDOWN_OFF = 184;  // u64\nconst PARAMS_USE_MARK_PRICE_LIQ_OFF = 192;    // bool (1 + 7 padding)\nconst PARAMS_EMERGENCY_LIQ_MARGIN_OFF = 200;  // u64\n// PERC-120: Dynamic fee params\nconst PARAMS_FEE_TIER2_BPS_OFF = 208;         // u64\nconst PARAMS_FEE_TIER3_BPS_OFF = 216;         // u64\nconst PARAMS_FEE_TIER2_THRESHOLD_OFF = 224;   // u128\nconst PARAMS_FEE_TIER3_THRESHOLD_OFF = 240;   // u128\nconst PARAMS_FEE_SPLIT_LP_OFF = 256;          // u64\nconst PARAMS_FEE_SPLIT_PROTOCOL_OFF = 264;    // u64\nconst PARAMS_FEE_SPLIT_CREATOR_OFF = 272;     // u64\nconst PARAMS_FEE_UTILIZATION_SURGE_OFF = 280; // u64\n// Total RiskParams = 288 bytes\n\n// =============================================================================\n// Account Layout (248 bytes, repr(C))\n// NOTE: Despite U128/I128 wrapper types in Rust, on-chain layout remains unchanged\n// Field order: account_id, capital, kind, pnl, reserved_pnl, warmup_started,\n//              warmup_slope, position_size, entry_price, funding_index,\n//              matcher_program, matcher_context, owner, fee_credits, last_fee_slot\n// =============================================================================\nconst ACCT_ACCOUNT_ID_OFF = 0;        // accountId (u64, 8 bytes), ends at 8\nconst ACCT_CAPITAL_OFF = 8;           // capital (U128, 16 bytes), ends at 24\nconst ACCT_KIND_OFF = 24;             // kind (u8, 1 byte + 7 padding), ends at 32\nconst ACCT_PNL_OFF = 32;              // pnl (I128, 16 bytes), ends at 48\nconst ACCT_RESERVED_PNL_OFF = 48;     // reserved_pnl (u64, 8 bytes), ends at 56\nconst ACCT_WARMUP_STARTED_OFF = 56;   // warmup_started (u64, 8 bytes), ends at 64\nconst ACCT_WARMUP_SLOPE_OFF = 64;     // warmup_slope (U128, 16 bytes), ends at 80\nconst ACCT_POSITION_SIZE_OFF = 80;    // position_size (I128, 16 bytes), ends at 96\nconst ACCT_ENTRY_PRICE_OFF = 96;      // entry_price (u64, 8 bytes), ends at 104\nconst ACCT_FUNDING_INDEX_OFF = 104;   // funding_index (I128, 16 bytes), ends at 120\nconst ACCT_MATCHER_PROGRAM_OFF = 120; // matcher_program (Pubkey, 32 bytes), ends at 152\nconst ACCT_MATCHER_CONTEXT_OFF = 152; // matcher_context (Pubkey, 32 bytes), ends at 184\nconst ACCT_OWNER_OFF = 184;           // owner (Pubkey, 32 bytes), ends at 216\nconst ACCT_FEE_CREDITS_OFF = 216;     // fee_credits (I128, 16 bytes), ends at 232\nconst ACCT_LAST_FEE_SLOT_OFF = 232;   // last_fee_slot (u64, 8 bytes), ends at 240\n\n// =============================================================================\n// Interfaces\n// =============================================================================\n\nexport interface InsuranceFund {\n  balance: bigint;\n  feeRevenue: bigint;\n}\n\nexport interface RiskParams {\n  warmupPeriodSlots: bigint;\n  maintenanceMarginBps: bigint;\n  initialMarginBps: bigint;\n  tradingFeeBps: bigint;\n  maxAccounts: bigint;\n  newAccountFee: bigint;\n  riskReductionThreshold: bigint;\n  maintenanceFeePerSlot: bigint;\n  maxCrankStalenessSlots: bigint;\n  liquidationFeeBps: bigint;\n  liquidationFeeCap: bigint;\n  liquidationBufferBps: bigint;\n  minLiquidationAbs: bigint;\n}\n\nexport interface EngineState {\n  vault: bigint;\n  insuranceFund: InsuranceFund;\n  currentSlot: bigint;\n  fundingIndexQpbE6: bigint;\n  lastFundingSlot: bigint;\n  fundingRateBpsPerSlotLast: bigint;  // Added: was missing from layout\n  lastCrankSlot: bigint;\n  maxCrankStalenessSlots: bigint;\n  totalOpenInterest: bigint;\n  cTot: bigint;              // Sum of all account capital (O(1) aggregate)\n  pnlPosTot: bigint;         // Sum of all positive PnL (O(1) aggregate)\n  liqCursor: number;\n  gcCursor: number;\n  lastSweepStartSlot: bigint;\n  lastSweepCompleteSlot: bigint;\n  crankCursor: number;\n  sweepStartIdx: number;\n  lifetimeLiquidations: bigint;\n  lifetimeForceCloses: bigint;\n  // LP Aggregates for funding\n  netLpPos: bigint;          // Net LP position (sum of all LP positions)\n  lpSumAbs: bigint;          // Sum of abs(LP positions)\n  lpMaxAbs: bigint;          // Max abs(LP position) monotone upper bound\n  lpMaxAbsSweep: bigint;     // In-progress max abs for current sweep\n  numUsedAccounts: number;\n  nextAccountId: bigint;\n}\n\nexport enum AccountKind {\n  User = 0,\n  LP = 1,\n}\n\nexport interface Account {\n  kind: AccountKind;\n  accountId: bigint;\n  capital: bigint;\n  pnl: bigint;\n  reservedPnl: bigint;\n  warmupStartedAtSlot: bigint;\n  warmupSlopePerStep: bigint;\n  positionSize: bigint;\n  entryPrice: bigint;\n  fundingIndex: bigint;\n  matcherProgram: PublicKey;\n  matcherContext: PublicKey;  // Pubkey (32 bytes)\n  owner: PublicKey;\n  feeCredits: bigint;\n  lastFeeSlot: bigint;\n}\n\n// =============================================================================\n// Helper: read signed i128 from buffer\n// Match Rust's I128 wrapper: read both halves as unsigned, then interpret as signed\n// =============================================================================\nfunction readI128LE(buf: Uint8Array, offset: number): bigint {\n  const lo = readU64LE(buf, offset);\n  const hi = readU64LE(buf, offset + 8);\n  const unsigned = (hi << 64n) | lo;\n  // If high bit is set, convert to negative (two's complement)\n  const SIGN_BIT = 1n << 127n;\n  if (unsigned >= SIGN_BIT) {\n    return unsigned - (1n << 128n);\n  }\n  return unsigned;\n}\n\nfunction readU128LE(buf: Uint8Array, offset: number): bigint {\n  const lo = readU64LE(buf, offset);\n  const hi = readU64LE(buf, offset + 8);\n  return (hi << 64n) | lo;\n}\n\n// =============================================================================\n// Parsing Functions\n// =============================================================================\n\n/**\n * Parse RiskParams from engine data.\n * Note: invert/unitScale are in MarketConfig, not RiskParams.\n */\nexport function parseParams(data: Uint8Array): RiskParams {\n  const base = ENGINE_OFF + ENGINE_PARAMS_OFF;\n  if (data.length < base + 144) {  // RiskParams is 144 bytes (5×u64 + 4×u128 + 3×u64 + 1×u128)\n    throw new Error(\"Slab data too short for RiskParams\");\n  }\n\n  return {\n    warmupPeriodSlots: readU64LE(data, base + PARAMS_WARMUP_PERIOD_OFF),\n    maintenanceMarginBps: readU64LE(data, base + PARAMS_MAINTENANCE_MARGIN_OFF),\n    initialMarginBps: readU64LE(data, base + PARAMS_INITIAL_MARGIN_OFF),\n    tradingFeeBps: readU64LE(data, base + PARAMS_TRADING_FEE_OFF),\n    maxAccounts: readU64LE(data, base + PARAMS_MAX_ACCOUNTS_OFF),\n    newAccountFee: readU128LE(data, base + PARAMS_NEW_ACCOUNT_FEE_OFF),\n    riskReductionThreshold: readU128LE(data, base + PARAMS_RISK_THRESHOLD_OFF),\n    maintenanceFeePerSlot: readU128LE(data, base + PARAMS_MAINTENANCE_FEE_OFF),\n    maxCrankStalenessSlots: readU64LE(data, base + PARAMS_MAX_CRANK_STALENESS_OFF),\n    liquidationFeeBps: readU64LE(data, base + PARAMS_LIQUIDATION_FEE_BPS_OFF),\n    liquidationFeeCap: readU128LE(data, base + PARAMS_LIQUIDATION_FEE_CAP_OFF),\n    liquidationBufferBps: readU64LE(data, base + PARAMS_LIQUIDATION_BUFFER_OFF),\n    minLiquidationAbs: readU128LE(data, base + PARAMS_MIN_LIQUIDATION_OFF),\n  };\n}\n\n/**\n * Parse RiskEngine state (excluding accounts array).\n */\nexport function parseEngine(data: Uint8Array): EngineState {\n  const base = ENGINE_OFF;\n  const layout = detectLayout(data.length);\n  const minLen = layout ? layout.accountsOff : ENGINE_ACCOUNTS_OFF;\n  if (data.length < base + minLen) {\n    throw new Error(\"Slab data too short for RiskEngine\");\n  }\n\n  return {\n    vault: readU128LE(data, base + ENGINE_VAULT_OFF),\n    insuranceFund: {\n      balance: readU128LE(data, base + ENGINE_INSURANCE_OFF),\n      feeRevenue: readU128LE(data, base + ENGINE_INSURANCE_OFF + 16),\n    },\n    currentSlot: readU64LE(data, base + ENGINE_CURRENT_SLOT_OFF),\n    fundingIndexQpbE6: readI128LE(data, base + ENGINE_FUNDING_INDEX_OFF),\n    lastFundingSlot: readU64LE(data, base + ENGINE_LAST_FUNDING_SLOT_OFF),\n    fundingRateBpsPerSlotLast: readI64LE(data, base + ENGINE_FUNDING_RATE_BPS_OFF),\n    lastCrankSlot: readU64LE(data, base + ENGINE_LAST_CRANK_SLOT_OFF),\n    maxCrankStalenessSlots: readU64LE(data, base + ENGINE_MAX_CRANK_STALENESS_OFF),\n    totalOpenInterest: readU128LE(data, base + ENGINE_TOTAL_OI_OFF),\n    cTot: readU128LE(data, base + ENGINE_C_TOT_OFF),\n    pnlPosTot: readU128LE(data, base + ENGINE_PNL_POS_TOT_OFF),\n    liqCursor: readU16LE(data, base + ENGINE_LIQ_CURSOR_OFF),\n    gcCursor: readU16LE(data, base + ENGINE_GC_CURSOR_OFF),\n    lastSweepStartSlot: readU64LE(data, base + ENGINE_LAST_SWEEP_START_OFF),\n    lastSweepCompleteSlot: readU64LE(data, base + ENGINE_LAST_SWEEP_COMPLETE_OFF),\n    crankCursor: readU16LE(data, base + ENGINE_CRANK_CURSOR_OFF),\n    sweepStartIdx: readU16LE(data, base + ENGINE_SWEEP_START_IDX_OFF),\n    lifetimeLiquidations: readU64LE(data, base + ENGINE_LIFETIME_LIQUIDATIONS_OFF),\n    lifetimeForceCloses: readU64LE(data, base + ENGINE_LIFETIME_FORCE_CLOSES_OFF),\n    // LP Aggregates for funding rate calculation\n    netLpPos: readI128LE(data, base + ENGINE_NET_LP_POS_OFF),\n    lpSumAbs: readU128LE(data, base + ENGINE_LP_SUM_ABS_OFF),\n    lpMaxAbs: readU128LE(data, base + ENGINE_LP_MAX_ABS_OFF),\n    lpMaxAbsSweep: readU128LE(data, base + ENGINE_LP_MAX_ABS_SWEEP_OFF),\n    numUsedAccounts: (() => {\n      const bw = layout ? layout.bitmapWords : DEFAULT_BITMAP_WORDS;\n      return readU16LE(data, base + ENGINE_BITMAP_OFF + bw * 8);\n    })(),\n    nextAccountId: (() => {\n      const bw = layout ? layout.bitmapWords : DEFAULT_BITMAP_WORDS;\n      const numUsedOff = ENGINE_BITMAP_OFF + bw * 8;\n      // next_account_id is u64 (8-byte aligned) after num_used(u16)\n      return readU64LE(data, base + Math.ceil((numUsedOff + 2) / 8) * 8);\n    })(),\n  };\n}\n\n/**\n * Read bitmap to get list of used account indices.\n */\nexport function parseUsedIndices(data: Uint8Array): number[] {\n  const layout = detectLayout(data.length);\n  const bitmapWords = layout ? layout.bitmapWords : DEFAULT_BITMAP_WORDS;\n  const base = ENGINE_OFF + ENGINE_BITMAP_OFF;\n  if (data.length < base + bitmapWords * 8) {\n    throw new Error(\"Slab data too short for bitmap\");\n  }\n\n  const used: number[] = [];\n  for (let word = 0; word < bitmapWords; word++) {\n    const bits = readU64LE(data, base + word * 8);\n    if (bits === 0n) continue;\n    for (let bit = 0; bit < 64; bit++) {\n      if ((bits >> BigInt(bit)) & 1n) {\n        used.push(word * 64 + bit);\n      }\n    }\n  }\n  return used;\n}\n\n/**\n * Check if a specific account index is used.\n */\nexport function isAccountUsed(data: Uint8Array, idx: number): boolean {\n  const layout = detectLayout(data.length);\n  const maxAcc = layout ? layout.maxAccounts : DEFAULT_MAX_ACCOUNTS;\n  if (!Number.isInteger(idx) || idx < 0 || idx >= maxAcc) return false;\n  const base = ENGINE_OFF + ENGINE_BITMAP_OFF;\n  const word = Math.floor(idx / 64);\n  const bit = idx % 64;\n  const bits = readU64LE(data, base + word * 8);\n  return ((bits >> BigInt(bit)) & 1n) !== 0n;\n}\n\n/**\n * Calculate the maximum valid account index for a given slab size.\n */\nexport function maxAccountIndex(dataLen: number): number {\n  const layout = detectLayout(dataLen);\n  const accOff = layout ? layout.accountsOff : ENGINE_ACCOUNTS_OFF;\n  const accountsEnd = dataLen - ENGINE_OFF - accOff;\n  if (accountsEnd <= 0) return 0;\n  return Math.floor(accountsEnd / ACCOUNT_SIZE);\n}\n\n/**\n * Parse a single account by index.\n */\nexport function parseAccount(data: Uint8Array, idx: number): Account {\n  const maxIdx = maxAccountIndex(data.length);\n  if (!Number.isInteger(idx) || idx < 0 || idx >= maxIdx) {\n    throw new Error(`Account index out of range: ${idx} (max: ${maxIdx - 1})`);\n  }\n\n  const layout = detectLayout(data.length);\n  const accOff = layout ? layout.accountsOff : ENGINE_ACCOUNTS_OFF;\n  const base = ENGINE_OFF + accOff + idx * ACCOUNT_SIZE;\n  if (data.length < base + ACCOUNT_SIZE) {\n    throw new Error(\"Slab data too short for account\");\n  }\n\n  // Read the kind field directly from offset 24 (u8 with 7 bytes padding)\n  const kindByte = readU8(data, base + ACCT_KIND_OFF);\n  const kind = kindByte === 1 ? AccountKind.LP : AccountKind.User;\n\n  return {\n    kind,\n    accountId: readU64LE(data, base + ACCT_ACCOUNT_ID_OFF),\n    capital: readU128LE(data, base + ACCT_CAPITAL_OFF),\n    pnl: readI128LE(data, base + ACCT_PNL_OFF),\n    reservedPnl: readU64LE(data, base + ACCT_RESERVED_PNL_OFF),\n    warmupStartedAtSlot: readU64LE(data, base + ACCT_WARMUP_STARTED_OFF),\n    warmupSlopePerStep: readU128LE(data, base + ACCT_WARMUP_SLOPE_OFF),\n    positionSize: readI128LE(data, base + ACCT_POSITION_SIZE_OFF),\n    entryPrice: readU64LE(data, base + ACCT_ENTRY_PRICE_OFF),\n    fundingIndex: readI128LE(data, base + ACCT_FUNDING_INDEX_OFF),\n    matcherProgram: new PublicKey(data.subarray(base + ACCT_MATCHER_PROGRAM_OFF, base + ACCT_MATCHER_PROGRAM_OFF + 32)),\n    matcherContext: new PublicKey(data.subarray(base + ACCT_MATCHER_CONTEXT_OFF, base + ACCT_MATCHER_CONTEXT_OFF + 32)),\n    owner: new PublicKey(data.subarray(base + ACCT_OWNER_OFF, base + ACCT_OWNER_OFF + 32)),\n    feeCredits: readI128LE(data, base + ACCT_FEE_CREDITS_OFF),\n    lastFeeSlot: readU64LE(data, base + ACCT_LAST_FEE_SLOT_OFF),\n  };\n}\n\n/**\n * Parse all used accounts.\n * Filters out indices that would be beyond the slab's account storage capacity.\n */\nexport function parseAllAccounts(data: Uint8Array): { idx: number; account: Account }[] {\n  const indices = parseUsedIndices(data);\n  const maxIdx = maxAccountIndex(data.length);\n  const validIndices = indices.filter(idx => idx < maxIdx);\n  return validIndices.map(idx => ({\n    idx,\n    account: parseAccount(data, idx),\n  }));\n}\n","import { PublicKey } from \"@solana/web3.js\";\n\nconst textEncoder = new TextEncoder();\n\n/**\n * Derive vault authority PDA.\n * Seeds: [\"vault\", slab_key]\n */\nexport function deriveVaultAuthority(\n  programId: PublicKey,\n  slab: PublicKey\n): [PublicKey, number] {\n  return PublicKey.findProgramAddressSync(\n    [textEncoder.encode(\"vault\"), slab.toBytes()],\n    programId\n  );\n}\n\n/**\n * Derive insurance LP mint PDA.\n * Seeds: [\"ins_lp\", slab_key]\n */\nexport function deriveInsuranceLpMint(\n  programId: PublicKey,\n  slab: PublicKey\n): [PublicKey, number] {\n  return PublicKey.findProgramAddressSync(\n    [textEncoder.encode(\"ins_lp\"), slab.toBytes()],\n    programId\n  );\n}\n\n/**\n * Derive LP PDA for TradeCpi.\n * Seeds: [\"lp\", slab_key, lp_idx as u16 LE]\n */\nexport function deriveLpPda(\n  programId: PublicKey,\n  slab: PublicKey,\n  lpIdx: number\n): [PublicKey, number] {\n  const idxBuf = new Uint8Array(2);\n  new DataView(idxBuf.buffer).setUint16(0, lpIdx, true);\n  return PublicKey.findProgramAddressSync(\n    [textEncoder.encode(\"lp\"), slab.toBytes(), idxBuf],\n    programId\n  );\n}\n\n// ---------------------------------------------------------------------------\n// DEX Program IDs\n// ---------------------------------------------------------------------------\n\n/** PumpSwap AMM program ID. */\nexport const PUMPSWAP_PROGRAM_ID = new PublicKey(\n  \"pAMMBay6oceH9fJKBRHGP5D4bD4sWpmSwMn52FMfXEA\"\n);\n\n/** Raydium CLMM (Concentrated Liquidity) program ID. */\nexport const RAYDIUM_CLMM_PROGRAM_ID = new PublicKey(\n  \"CAMMCzo5YL8w4VFF8KVHrK22GGUsp5VTaW7grrKgrWqK\"\n);\n\n/** Meteora DLMM (Dynamic Liquidity Market Maker) program ID. */\nexport const METEORA_DLMM_PROGRAM_ID = new PublicKey(\n  \"LBUZKhRxPF3XUpBCjp4YzTKgLccjZhTSDM9YuVaPwxo\"\n);\n\n// ---------------------------------------------------------------------------\n// Pyth Push Oracle\n// ---------------------------------------------------------------------------\n\n/** Pyth Push Oracle program on mainnet. */\nexport const PYTH_PUSH_ORACLE_PROGRAM_ID = new PublicKey(\n  \"pythWSnswVUd12oZpeFP8e9CVaEqJg25g1Vtc2biRsT\"\n);\n\n/**\n * Derive the Pyth Push Oracle PDA for a given feed ID.\n * Seeds: [shard_id(u16 LE, always 0), feed_id(32 bytes)]\n * Program: pythWSnswVUd12oZpeFP8e9CVaEqJg25g1Vtc2biRsT\n */\nexport function derivePythPushOraclePDA(feedIdHex: string): [PublicKey, number] {\n  const feedId = new Uint8Array(32);\n  for (let i = 0; i < 32; i++) {\n    feedId[i] = parseInt(feedIdHex.substring(i * 2, i * 2 + 2), 16);\n  }\n  const shardBuf = new Uint8Array(2); // shard_id = 0 (u16 LE)\n  return PublicKey.findProgramAddressSync(\n    [shardBuf, feedId],\n    PYTH_PUSH_ORACLE_PROGRAM_ID,\n  );\n}\n","import { Connection, PublicKey } from \"@solana/web3.js\";\nimport {\n  getAssociatedTokenAddress,\n  getAssociatedTokenAddressSync,\n  getAccount,\n  Account,\n  TOKEN_PROGRAM_ID,\n} from \"@solana/spl-token\";\nimport { TOKEN_2022_PROGRAM_ID } from \"./token-program.js\";\n\n/**\n * Get the associated token address for an owner and mint.\n * Supports both standard SPL Token and Token2022 via optional tokenProgramId.\n */\nexport async function getAta(\n  owner: PublicKey,\n  mint: PublicKey,\n  tokenProgramId: PublicKey = TOKEN_PROGRAM_ID,\n): Promise<PublicKey> {\n  return getAssociatedTokenAddress(mint, owner, false, tokenProgramId);\n}\n\n/**\n * Synchronous version of getAta.\n * Supports both standard SPL Token and Token2022 via optional tokenProgramId.\n */\nexport function getAtaSync(\n  owner: PublicKey,\n  mint: PublicKey,\n  tokenProgramId: PublicKey = TOKEN_PROGRAM_ID,\n): PublicKey {\n  return getAssociatedTokenAddressSync(mint, owner, false, tokenProgramId);\n}\n\n/**\n * Fetch token account info.\n * Supports both standard SPL Token and Token2022 via optional tokenProgramId.\n * Throws if account doesn't exist.\n */\nexport async function fetchTokenAccount(\n  connection: Connection,\n  address: PublicKey,\n  tokenProgramId: PublicKey = TOKEN_PROGRAM_ID,\n): Promise<Account> {\n  return getAccount(connection, address, undefined, tokenProgramId);\n}\n","import { Connection, PublicKey } from \"@solana/web3.js\";\nimport {\n  parseHeader,\n  parseConfig,\n  parseParams,\n  type SlabHeader,\n  type MarketConfig,\n  type EngineState,\n  type RiskParams,\n} from \"./slab.js\";\n\n/** Bitmap offset within engine struct (updated for PERC-120/121/122 struct changes) */\nconst ENGINE_BITMAP_OFF = 576;\n\n/**\n * A discovered Percolator market from on-chain program accounts.\n */\nexport interface DiscoveredMarket {\n  slabAddress: PublicKey;\n  /** The program that owns this slab account */\n  programId: PublicKey;\n  header: SlabHeader;\n  config: MarketConfig;\n  engine: EngineState;\n  params: RiskParams;\n}\n\n/** PERCOLAT magic bytes — stored little-endian on-chain as TALOCREP */\nconst MAGIC_BYTES = new Uint8Array([0x54, 0x41, 0x4c, 0x4f, 0x43, 0x52, 0x45, 0x50]);\n\n/**\n * Slab tier definitions.\n * IMPORTANT: dataSize must match the compiled program's SLAB_LEN for that MAX_ACCOUNTS.\n * The on-chain program has a hardcoded SLAB_LEN — slab account data.len() must equal it exactly.\n *\n * Layout: HEADER(104) + CONFIG(352) + RiskEngine(variable by tier)\n *   ENGINE_OFF = align_up(104 + 352, 8) = 456  (SBF: u128 align = 8)\n *   RiskEngine = fixed(576) + bitmap(BW*8) + post_bitmap(18) + next_free(N*2) + pad + accounts(N*248)\n *\n * Verified against deployed devnet programs (PERC-131 e2e testing):\n *   Small  (256 slots):  program logs expected = 0xfe40 = 65088\n *   Medium (1024 slots): computed from identical struct layout\n *   Large  (4096 slots): computed from identical struct layout\n */\nexport const SLAB_TIERS = {\n  small:  { maxAccounts: 256,  dataSize: 65_088,    label: \"Small\",  description: \"256 slots · ~0.45 SOL\" },\n  medium: { maxAccounts: 1024, dataSize: 257_184,   label: \"Medium\", description: \"1,024 slots · ~1.79 SOL\" },\n  large:  { maxAccounts: 4096, dataSize: 1_025_568, label: \"Large\",  description: \"4,096 slots · ~7.14 SOL\" },\n} as const;\n\nexport type SlabTierKey = keyof typeof SLAB_TIERS;\n\n/** Calculate slab data size for arbitrary account count.\n *\n * Layout (SBF, u128 align = 8):\n *   HEADER(104) + CONFIG(352) → ENGINE_OFF = 456\n *   RiskEngine fixed scalars: 576 bytes (vault through lp_max_abs_sweep)\n *   + bitmap: ceil(N/64)*8\n *   + num_used_accounts(u16) + pad(6) + next_account_id(u64) + free_head(u16) = 18\n *   + next_free: N*2\n *   + pad to 8-byte alignment for Account array\n *   + accounts: N*248\n *\n * Must match the on-chain program's SLAB_LEN exactly.\n */\nexport function slabDataSize(maxAccounts: number): number {\n  const ENGINE_OFF_LOCAL = 456; // align_up(104 + 352, 8)\n  const ENGINE_FIXED = 576;     // scalars before bitmap\n  const ACCOUNT_SIZE = 248;\n  const bitmapBytes = Math.ceil(maxAccounts / 64) * 8;\n  // After bitmap: num_used(u16,2) + pad(6) + next_account_id(u64,8) + free_head(u16,2) = 18\n  const postBitmap = 18;\n  const nextFreeBytes = maxAccounts * 2;\n  const preAccountsLen = ENGINE_FIXED + bitmapBytes + postBitmap + nextFreeBytes;\n  // Align to 8 bytes for Account (max field align = 8 on SBF)\n  const accountsOff = Math.ceil(preAccountsLen / 8) * 8;\n  return ENGINE_OFF_LOCAL + accountsOff + maxAccounts * ACCOUNT_SIZE;\n}\n\n/** All known slab data sizes for discovery */\nconst ALL_SLAB_SIZES = Object.values(SLAB_TIERS).map(t => t.dataSize);\n\n/** Legacy constant for backward compat */\nconst SLAB_DATA_SIZE = SLAB_TIERS.large.dataSize;\n\n/** We need header(104) + config(352) + engine up to nextAccountId (~1100). Total ~1556. Use 1600 for margin. */\nconst HEADER_SLICE_LENGTH = 1600;\n\nconst ENGINE_OFF = 456;\n\nfunction dv(data: Uint8Array): DataView {\n  return new DataView(data.buffer, data.byteOffset, data.byteLength);\n}\nfunction readU16LE(data: Uint8Array, off: number): number {\n  return dv(data).getUint16(off, true);\n}\nfunction readU64LE(data: Uint8Array, off: number): bigint {\n  return dv(data).getBigUint64(off, true);\n}\nfunction readI64LE(data: Uint8Array, off: number): bigint {\n  return dv(data).getBigInt64(off, true);\n}\nfunction readU128LE(buf: Uint8Array, offset: number): bigint {\n  const lo = readU64LE(buf, offset);\n  const hi = readU64LE(buf, offset + 8);\n  return (hi << 64n) | lo;\n}\nfunction readI128LE(buf: Uint8Array, offset: number): bigint {\n  const lo = readU64LE(buf, offset);\n  const hi = readU64LE(buf, offset + 8);\n  const unsigned = (hi << 64n) | lo;\n  const SIGN_BIT = 1n << 127n;\n  if (unsigned >= SIGN_BIT) return unsigned - (1n << 128n);\n  return unsigned;\n}\n\n/**\n * Light engine parser that works with partial slab data (dataSlice, no accounts array).\n * @param maxAccounts — the tier's max accounts (256/1024/4096) to compute correct bitmap offsets\n */\nfunction parseEngineLight(data: Uint8Array, maxAccounts: number = 4096): EngineState {\n  const base = ENGINE_OFF;\n  const minLen = base + ENGINE_BITMAP_OFF; // need at least fixed engine fields\n  if (data.length < minLen) {\n    throw new Error(`Slab data too short for engine light parse: ${data.length} < ${minLen}`);\n  }\n\n  // Compute tier-dependent offsets for numUsedAccounts and nextAccountId\n  const bitmapWords = Math.ceil(maxAccounts / 64);\n  const numUsedOff = ENGINE_BITMAP_OFF + bitmapWords * 8; // u16 right after bitmap\n  const nextAccountIdOff = Math.ceil((numUsedOff + 2) / 8) * 8; // u64, 8-byte aligned\n\n  // Check if the partial slice is long enough to read these fields\n  const canReadNumUsed = data.length >= base + numUsedOff + 2;\n  const canReadNextId = data.length >= base + nextAccountIdOff + 8;\n\n  // Engine field offsets within engine struct (updated for PERC-120/121/122):\n  // vault(0) + insurance(16,32) + params(48,288) + currentSlot(336) + fundingIndex(344,16)\n  // + lastFundingSlot(360) + fundingRateBps(368) + markPrice(376) + fundingFrozen(384,8)\n  // + frozenRate(392) + lastCrankSlot(400) + maxCrankStaleness(408) + totalOI(416,16)\n  // + cTot(432,16) + pnlPosTot(448,16) + liqCursor(464,2) + gcCursor(466,2)\n  // + lastSweepStart(472) + lastSweepComplete(480) + crankCursor(488,2) + sweepStartIdx(490,2)\n  // + lifetimeLiquidations(496) + lifetimeForceCloses(504)\n  // + netLpPos(512,16) + lpSumAbs(528,16) + lpMaxAbs(544,16) + lpMaxAbsSweep(560,16)\n  // + bitmap(576)\n  return {\n    vault: readU128LE(data, base + 0),\n    insuranceFund: {\n      balance: readU128LE(data, base + 16),\n      feeRevenue: readU128LE(data, base + 32),\n    },\n    currentSlot: readU64LE(data, base + 336),\n    fundingIndexQpbE6: readI128LE(data, base + 344),\n    lastFundingSlot: readU64LE(data, base + 360),\n    fundingRateBpsPerSlotLast: readI64LE(data, base + 368),\n    lastCrankSlot: readU64LE(data, base + 400),\n    maxCrankStalenessSlots: readU64LE(data, base + 408),\n    totalOpenInterest: readU128LE(data, base + 416),\n    cTot: readU128LE(data, base + 432),\n    pnlPosTot: readU128LE(data, base + 448),\n    liqCursor: readU16LE(data, base + 464),\n    gcCursor: readU16LE(data, base + 466),\n    lastSweepStartSlot: readU64LE(data, base + 472),\n    lastSweepCompleteSlot: readU64LE(data, base + 480),\n    crankCursor: readU16LE(data, base + 488),\n    sweepStartIdx: readU16LE(data, base + 490),\n    lifetimeLiquidations: readU64LE(data, base + 496),\n    lifetimeForceCloses: readU64LE(data, base + 504),\n    netLpPos: readI128LE(data, base + 512),\n    lpSumAbs: readU128LE(data, base + 528),\n    lpMaxAbs: readU128LE(data, base + 544),\n    lpMaxAbsSweep: readU128LE(data, base + 560),\n    numUsedAccounts: canReadNumUsed ? readU16LE(data, base + numUsedOff) : 0,\n    nextAccountId: canReadNextId ? readU64LE(data, base + nextAccountIdOff) : 0n,\n  };\n}\n\n/**\n * Discover all Percolator markets owned by the given program.\n * Uses getProgramAccounts with dataSize filter + dataSlice to download only ~1400 bytes per slab.\n */\nexport async function discoverMarkets(\n  connection: Connection,\n  programId: PublicKey,\n): Promise<DiscoveredMarket[]> {\n  // Query all known slab sizes in parallel to discover markets of any tier\n  // Track which tier each account belongs to for correct offset computation\n  const ALL_TIERS = Object.values(SLAB_TIERS);\n  let rawAccounts: { pubkey: PublicKey; account: { data: Buffer | Uint8Array }; maxAccounts: number }[] = [];\n  try {\n    const queries = ALL_TIERS.map(tier =>\n      connection.getProgramAccounts(programId, {\n        filters: [{ dataSize: tier.dataSize }],\n        dataSlice: { offset: 0, length: HEADER_SLICE_LENGTH },\n      }).then(results => results.map(entry => ({ ...entry, maxAccounts: tier.maxAccounts })))\n    );\n    const results = await Promise.allSettled(queries);\n    let hadRejection = false;\n    for (const result of results) {\n      if (result.status === \"fulfilled\") {\n        for (const entry of result.value) {\n          rawAccounts.push(entry as { pubkey: PublicKey; account: { data: Buffer | Uint8Array }; maxAccounts: number });\n        }\n      } else {\n        hadRejection = true;\n        console.warn(\n          \"[discoverMarkets] Tier query rejected:\",\n          result.reason instanceof Error ? result.reason.message : result.reason,\n        );\n      }\n    }\n    // If any tier queries failed and we found no accounts, fall back to memcmp discovery\n    if (hadRejection && rawAccounts.length === 0) {\n      console.warn(\"[discoverMarkets] All tier queries failed, falling back to memcmp\");\n      const fallback = await connection.getProgramAccounts(programId, {\n        filters: [\n          {\n            memcmp: {\n              offset: 0,\n              bytes: \"F6P2QNqpQV5\", // base58 of TALOCREP (u64 LE magic)\n            },\n          },\n        ],\n        dataSlice: { offset: 0, length: HEADER_SLICE_LENGTH },\n      });\n      rawAccounts = [...fallback].map(e => ({ ...e, maxAccounts: 4096 })) as { pubkey: PublicKey; account: { data: Buffer | Uint8Array }; maxAccounts: number }[];\n    }\n  } catch (err) {\n    console.warn(\n      \"[discoverMarkets] dataSize filters failed, falling back to memcmp:\",\n      err instanceof Error ? err.message : err,\n    );\n    const fallback = await connection.getProgramAccounts(programId, {\n      filters: [\n        {\n          memcmp: {\n            offset: 0,\n            bytes: \"F6P2QNqpQV5\", // base58 of TALOCREP (u64 LE magic)\n          },\n        },\n      ],\n      dataSlice: { offset: 0, length: HEADER_SLICE_LENGTH },\n    });\n    rawAccounts = [...fallback].map(e => ({ ...e, maxAccounts: 4096 })) as { pubkey: PublicKey; account: { data: Buffer | Uint8Array }; maxAccounts: number }[];\n  }\n  const accounts = rawAccounts;\n\n  const markets: DiscoveredMarket[] = [];\n\n  for (const { pubkey, account, maxAccounts } of accounts) {\n    const data = new Uint8Array(account.data);\n\n    let valid = true;\n    for (let i = 0; i < MAGIC_BYTES.length; i++) {\n      if (data[i] !== MAGIC_BYTES[i]) {\n        valid = false;\n        break;\n      }\n    }\n    if (!valid) continue;\n\n    try {\n      const header = parseHeader(data);\n      const config = parseConfig(data);\n      const engine = parseEngineLight(data, maxAccounts);\n      const params = parseParams(data);\n\n      markets.push({ slabAddress: pubkey, programId, header, config, engine, params });\n    } catch (err) {\n      console.warn(\n        `[discoverMarkets] Failed to parse account ${pubkey.toBase58()}:`,\n        err instanceof Error ? err.message : err,\n      );\n    }\n  }\n\n  return markets;\n}\n","import { PublicKey } from \"@solana/web3.js\";\nimport {\n  PUMPSWAP_PROGRAM_ID,\n  RAYDIUM_CLMM_PROGRAM_ID,\n  METEORA_DLMM_PROGRAM_ID,\n} from \"./pda.js\";\n\nexport type DexType = \"pumpswap\" | \"raydium-clmm\" | \"meteora-dlmm\";\n\nexport interface DexPoolInfo {\n  dexType: DexType;\n  poolAddress: PublicKey;\n  baseMint: PublicKey;\n  quoteMint: PublicKey;\n  baseVault?: PublicKey;  // PumpSwap only\n  quoteVault?: PublicKey; // PumpSwap only\n}\n\n/**\n * Detect DEX type from the program that owns the pool account.\n *\n * @param ownerProgramId - The program ID that owns the pool account\n * @returns The detected DEX type, or `null` if the owner is not a supported DEX program\n *\n * Supported DEX programs:\n * - PumpSwap (constant-product AMM)\n * - Raydium CLMM (concentrated liquidity)\n * - Meteora DLMM (discretized liquidity)\n */\nexport function detectDexType(ownerProgramId: PublicKey): DexType | null {\n  if (ownerProgramId.equals(PUMPSWAP_PROGRAM_ID)) return \"pumpswap\";\n  if (ownerProgramId.equals(RAYDIUM_CLMM_PROGRAM_ID)) return \"raydium-clmm\";\n  if (ownerProgramId.equals(METEORA_DLMM_PROGRAM_ID)) return \"meteora-dlmm\";\n  return null;\n}\n\n/**\n * Parse a DEX pool account into a {@link DexPoolInfo} struct.\n *\n * @param dexType - The type of DEX (pumpswap, raydium-clmm, or meteora-dlmm)\n * @param poolAddress - The on-chain address of the pool account\n * @param data - Raw account data bytes\n * @returns Parsed pool info including mints and (for PumpSwap) vault addresses\n * @throws Error if data is too short for the given DEX type\n */\nexport function parseDexPool(\n  dexType: DexType,\n  poolAddress: PublicKey,\n  data: Uint8Array,\n): DexPoolInfo {\n  switch (dexType) {\n    case \"pumpswap\":\n      return parsePumpSwapPool(poolAddress, data);\n    case \"raydium-clmm\":\n      return parseRaydiumClmmPool(poolAddress, data);\n    case \"meteora-dlmm\":\n      return parseMeteoraPool(poolAddress, data);\n  }\n}\n\n/**\n * Compute the spot price from a DEX pool in e6 format (i.e., 1.0 = 1_000_000).\n *\n * **SECURITY NOTE:** DEX spot prices have no staleness or confidence checks and are\n * vulnerable to flash-loan manipulation within a single transaction. For high-value\n * markets, prefer Pyth or Chainlink oracles.\n *\n * @param dexType - The type of DEX\n * @param data - Raw pool account data\n * @param vaultData - For PumpSwap only: base and quote vault account data\n * @returns Price in e6 format (quote per base token)\n * @throws Error if data is too short or computation fails\n */\nexport function computeDexSpotPriceE6(\n  dexType: DexType,\n  data: Uint8Array,\n  vaultData?: { base: Uint8Array; quote: Uint8Array },\n): bigint {\n  switch (dexType) {\n    case \"pumpswap\":\n      if (!vaultData) throw new Error(\"PumpSwap requires vaultData (base and quote vault accounts)\");\n      return computePumpSwapPriceE6(data, vaultData);\n    case \"raydium-clmm\":\n      return computeRaydiumClmmPriceE6(data);\n    case \"meteora-dlmm\":\n      return computeMeteoraDlmmPriceE6(data);\n  }\n}\n\n// ============================================================================\n// PumpSwap\n// ============================================================================\n\nconst PUMPSWAP_MIN_LEN = 195;\n\n/**\n * Parse a PumpSwap constant-product AMM pool account.\n * @internal\n */\nfunction parsePumpSwapPool(poolAddress: PublicKey, data: Uint8Array): DexPoolInfo {\n  if (data.length < PUMPSWAP_MIN_LEN) {\n    throw new Error(`PumpSwap pool data too short: ${data.length} < ${PUMPSWAP_MIN_LEN}`);\n  }\n  return {\n    dexType: \"pumpswap\",\n    poolAddress,\n    baseMint: new PublicKey(data.slice(35, 67)),\n    quoteMint: new PublicKey(data.slice(67, 99)),\n    baseVault: new PublicKey(data.slice(131, 163)),\n    quoteVault: new PublicKey(data.slice(163, 195)),\n  };\n}\n\nconst SPL_TOKEN_AMOUNT_MIN_LEN = 72;\n\n/**\n * Compute PumpSwap price: quote_amount * 1e6 / base_amount.\n * @internal\n */\nfunction computePumpSwapPriceE6(\n  _poolData: Uint8Array,\n  vaultData: { base: Uint8Array; quote: Uint8Array },\n): bigint {\n  if (vaultData.base.length < SPL_TOKEN_AMOUNT_MIN_LEN) {\n    throw new Error(`PumpSwap base vault data too short: ${vaultData.base.length} < ${SPL_TOKEN_AMOUNT_MIN_LEN}`);\n  }\n  if (vaultData.quote.length < SPL_TOKEN_AMOUNT_MIN_LEN) {\n    throw new Error(`PumpSwap quote vault data too short: ${vaultData.quote.length} < ${SPL_TOKEN_AMOUNT_MIN_LEN}`);\n  }\n\n  const baseDv = new DataView(vaultData.base.buffer, vaultData.base.byteOffset, vaultData.base.byteLength);\n  const quoteDv = new DataView(vaultData.quote.buffer, vaultData.quote.byteOffset, vaultData.quote.byteLength);\n\n  const baseAmount = readU64LE(baseDv, 64);\n  const quoteAmount = readU64LE(quoteDv, 64);\n\n  if (baseAmount === 0n) return 0n;\n  return (quoteAmount * 1_000_000n) / baseAmount;\n}\n\n// ============================================================================\n// Raydium CLMM\n// ============================================================================\n\nconst RAYDIUM_CLMM_MIN_LEN = 269; // need at least through sqrt_price_x64 (253 + 16)\n\n/**\n * Parse a Raydium CLMM (concentrated liquidity) pool account.\n * @internal\n */\nfunction parseRaydiumClmmPool(poolAddress: PublicKey, data: Uint8Array): DexPoolInfo {\n  if (data.length < RAYDIUM_CLMM_MIN_LEN) {\n    throw new Error(`Raydium CLMM pool data too short: ${data.length} < ${RAYDIUM_CLMM_MIN_LEN}`);\n  }\n  return {\n    dexType: \"raydium-clmm\",\n    poolAddress,\n    baseMint: new PublicKey(data.slice(73, 105)),\n    quoteMint: new PublicKey(data.slice(105, 137)),\n  };\n}\n\n/**\n * Compute Raydium CLMM spot price from sqrt_price_x64 (Q64.64 fixed-point).\n *\n * Formula: `price_e6 = (sqrt^2 / 2^128) * 10^(6 + decimals0 - decimals1)`\n *\n * Uses a precision-preserving approach: scales sqrt by 1e6 before shifting,\n * preventing zero results for micro-priced tokens (memecoins where sqrt < 2^64).\n *\n * @internal\n */\nfunction computeRaydiumClmmPriceE6(data: Uint8Array): bigint {\n  if (data.length < RAYDIUM_CLMM_MIN_LEN) {\n    throw new Error(`Raydium CLMM data too short: ${data.length} < ${RAYDIUM_CLMM_MIN_LEN}`);\n  }\n  const dv = new DataView(data.buffer, data.byteOffset, data.byteLength);\n\n  const decimals0 = data[233];\n  const decimals1 = data[234];\n\n  const sqrtPriceX64 = readU128LE(dv, 253);\n\n  if (sqrtPriceX64 === 0n) return 0n;\n\n  // PRECISION FIX: Scale up by 1e6 BEFORE right-shifting to preserve bits\n  // for micro-priced tokens where sqrtPriceX64 < 2^64.\n  // scaled_sqrt = sqrt * 1_000_000\n  // term = scaled_sqrt >> 64  (preserves 6 more decimal digits)\n  // price_e6_raw = term * sqrt >> 64\n  // Then adjust decimal_diff by -6 (since we already embedded 1e6).\n  const scaledSqrt = sqrtPriceX64 * 1_000_000n;\n  const term = scaledSqrt >> 64n;\n  const priceE6Raw = (term * sqrtPriceX64) >> 64n;\n\n  const decimalDiff = 6 + decimals0 - decimals1;\n  const adjustedDiff = decimalDiff - 6;\n\n  if (adjustedDiff >= 0) {\n    const scale = 10n ** BigInt(adjustedDiff);\n    return priceE6Raw * scale;\n  } else {\n    const scale = 10n ** BigInt(-adjustedDiff);\n    return priceE6Raw / scale;\n  }\n}\n\n// ============================================================================\n// Meteora DLMM\n// ============================================================================\n\nconst METEORA_DLMM_MIN_LEN = 145;\n\n/**\n * Parse a Meteora DLMM (discretized liquidity) pool account.\n * @internal\n */\nfunction parseMeteoraPool(poolAddress: PublicKey, data: Uint8Array): DexPoolInfo {\n  if (data.length < METEORA_DLMM_MIN_LEN) {\n    throw new Error(`Meteora DLMM pool data too short: ${data.length} < ${METEORA_DLMM_MIN_LEN}`);\n  }\n  return {\n    dexType: \"meteora-dlmm\",\n    poolAddress,\n    baseMint: new PublicKey(data.slice(81, 113)),\n    quoteMint: new PublicKey(data.slice(113, 145)),\n  };\n}\n\n/**\n * Compute Meteora DLMM spot price from active_id and bin_step.\n *\n * Formula: `price = (1 + bin_step/10000) ^ active_id`\n *\n * Uses binary exponentiation with 1e18 fixed-point precision, then converts to e6.\n * For negative active_id, computes the inverse.\n *\n * @internal\n */\nfunction computeMeteoraDlmmPriceE6(data: Uint8Array): bigint {\n  if (data.length < METEORA_DLMM_MIN_LEN) {\n    throw new Error(`Meteora DLMM data too short: ${data.length} < ${METEORA_DLMM_MIN_LEN}`);\n  }\n  const dv = new DataView(data.buffer, data.byteOffset, data.byteLength);\n\n  const binStep = dv.getUint16(74, true);\n  const activeId = dv.getInt32(77, true);\n\n  if (binStep === 0) return 0n;\n\n  const SCALE = 1_000_000_000_000_000_000n; // 1e18\n  const base = SCALE + (BigInt(binStep) * SCALE) / 10_000n;\n\n  const isNeg = activeId < 0;\n  let exp = isNeg ? BigInt(-activeId) : BigInt(activeId);\n\n  let result = SCALE;\n  let b = base;\n\n  while (exp > 0n) {\n    if (exp & 1n) {\n      result = (result * b) / SCALE;\n    }\n    exp >>= 1n;\n    if (exp > 0n) {\n      b = (b * b) / SCALE;\n    }\n  }\n\n  if (isNeg) {\n    if (result === 0n) return 0n;\n    return (SCALE * 1_000_000n) / result;\n  } else {\n    return result / 1_000_000_000_000n; // 1e18 → 1e6\n  }\n}\n\n// ============================================================================\n// Helpers\n// ============================================================================\n\n/** Read a little-endian u64 from a DataView. */\nfunction readU64LE(dv: DataView, offset: number): bigint {\n  const lo = BigInt(dv.getUint32(offset, true));\n  const hi = BigInt(dv.getUint32(offset + 4, true));\n  return lo | (hi << 32n);\n}\n\n/** Read a little-endian u128 from a DataView. */\nfunction readU128LE(dv: DataView, offset: number): bigint {\n  const lo = readU64LE(dv, offset);\n  const hi = readU64LE(dv, offset + 8);\n  return lo | (hi << 64n);\n}\n","import { Connection, PublicKey } from \"@solana/web3.js\";\nimport { TOKEN_PROGRAM_ID } from \"@solana/spl-token\";\n\n/**\n * Token2022 (Token Extensions) program ID.\n */\nexport const TOKEN_2022_PROGRAM_ID = new PublicKey(\n  \"TokenzQdBNbLqP5VEhdkAS6EPFLC1PHnBqCXEpPxuEb\",\n);\n\n/**\n * Detect which token program owns a given mint account.\n * Returns the owner program ID (TOKEN_PROGRAM_ID or TOKEN_2022_PROGRAM_ID).\n * Throws if the mint account doesn't exist.\n */\nexport async function detectTokenProgram(\n  connection: Connection,\n  mint: PublicKey,\n): Promise<PublicKey> {\n  const info = await connection.getAccountInfo(mint);\n  if (!info) throw new Error(`Mint account not found: ${mint.toBase58()}`);\n  return info.owner;\n}\n\n/**\n * Check if a given token program ID is Token2022.\n */\nexport function isToken2022(tokenProgramId: PublicKey): boolean {\n  return tokenProgramId.equals(TOKEN_2022_PROGRAM_ID);\n}\n\n/**\n * Check if a given token program ID is the standard SPL Token program.\n */\nexport function isStandardToken(tokenProgramId: PublicKey): boolean {\n  return tokenProgramId.equals(TOKEN_PROGRAM_ID);\n}\n","/**\n * @module stake\n * Percolator Insurance LP Staking program — instruction encoders, PDA derivation, and account specs.\n *\n * Program: percolator-stake (dcccrypto/percolator-stake)\n * Deployed devnet: 4mJ8Cas... (TODO: confirm full address from devops)\n */\n\nimport { PublicKey, SystemProgram, SYSVAR_RENT_PUBKEY, SYSVAR_CLOCK_PUBKEY } from '@solana/web3.js';\nimport { TOKEN_PROGRAM_ID } from '@solana/spl-token';\n\n// ═══════════════════════════════════════════════════════════════\n// Program ID\n// ═══════════════════════════════════════════════════════════════\n\n/** Percolator Stake program ID (devnet). Update for mainnet. */\nexport const STAKE_PROGRAM_ID = new PublicKey(\n  '4mJ8CasWfJCGEjGNaJThNfFfUWJTfZLBwz6qmUGqxVMc'\n);\n\n// ═══════════════════════════════════════════════════════════════\n// Instruction Tags (match src/instruction.rs)\n// ═══════════════════════════════════════════════════════════════\n\nexport const STAKE_IX = {\n  InitPool: 0,\n  Deposit: 1,\n  Withdraw: 2,\n  FlushToInsurance: 3,\n  UpdateConfig: 4,\n  TransferAdmin: 5,\n  AdminSetOracleAuthority: 6,\n  AdminSetRiskThreshold: 7,\n  AdminSetMaintenanceFee: 8,\n  AdminResolveMarket: 9,\n  AdminWithdrawInsurance: 10,\n  AdminSetInsurancePolicy: 11,\n} as const;\n\n// ═══════════════════════════════════════════════════════════════\n// PDA Derivation\n// ═══════════════════════════════════════════════════════════════\n\n/** Derive the stake pool PDA for a given slab (market). */\nexport function deriveStakePool(slab: PublicKey, programId = STAKE_PROGRAM_ID) {\n  return PublicKey.findProgramAddressSync(\n    [Buffer.from('stake_pool'), slab.toBuffer()],\n    programId,\n  );\n}\n\n/** Derive the vault authority PDA (signs CPI, owns LP mint + vault). */\nexport function deriveStakeVaultAuth(pool: PublicKey, programId = STAKE_PROGRAM_ID) {\n  return PublicKey.findProgramAddressSync(\n    [Buffer.from('vault_auth'), pool.toBuffer()],\n    programId,\n  );\n}\n\n/** Derive the per-user deposit PDA (tracks cooldown, deposit time). */\nexport function deriveDepositPda(pool: PublicKey, user: PublicKey, programId = STAKE_PROGRAM_ID) {\n  return PublicKey.findProgramAddressSync(\n    [Buffer.from('deposit'), pool.toBuffer(), user.toBuffer()],\n    programId,\n  );\n}\n\n// ═══════════════════════════════════════════════════════════════\n// Instruction Encoders\n// ═══════════════════════════════════════════════════════════════\n\nfunction u64Le(v: bigint | number): Buffer {\n  const buf = Buffer.alloc(8);\n  buf.writeBigUInt64LE(BigInt(v));\n  return buf;\n}\n\nfunction u128Le(v: bigint | number): Buffer {\n  const buf = Buffer.alloc(16);\n  const big = BigInt(v);\n  buf.writeBigUInt64LE(big & 0xFFFFFFFFFFFFFFFFn, 0);\n  buf.writeBigUInt64LE(big >> 64n, 8);\n  return buf;\n}\n\nfunction u16Le(v: number): Buffer {\n  const buf = Buffer.alloc(2);\n  buf.writeUInt16LE(v);\n  return buf;\n}\n\n/** Tag 0: InitPool — create stake pool for a slab. */\nexport function encodeStakeInitPool(cooldownSlots: bigint | number, depositCap: bigint | number): Buffer {\n  return Buffer.concat([\n    Buffer.from([STAKE_IX.InitPool]),\n    u64Le(cooldownSlots),\n    u64Le(depositCap),\n  ]);\n}\n\n/** Tag 1: Deposit — deposit collateral, receive LP tokens. */\nexport function encodeStakeDeposit(amount: bigint | number): Buffer {\n  return Buffer.concat([Buffer.from([STAKE_IX.Deposit]), u64Le(amount)]);\n}\n\n/** Tag 2: Withdraw — burn LP tokens, receive collateral (subject to cooldown). */\nexport function encodeStakeWithdraw(lpAmount: bigint | number): Buffer {\n  return Buffer.concat([Buffer.from([STAKE_IX.Withdraw]), u64Le(lpAmount)]);\n}\n\n/** Tag 3: FlushToInsurance — move collateral from stake vault to wrapper insurance. */\nexport function encodeStakeFlushToInsurance(amount: bigint | number): Buffer {\n  return Buffer.concat([Buffer.from([STAKE_IX.FlushToInsurance]), u64Le(amount)]);\n}\n\n/** Tag 4: UpdateConfig — update cooldown and/or deposit cap. */\nexport function encodeStakeUpdateConfig(\n  newCooldownSlots?: bigint | number,\n  newDepositCap?: bigint | number,\n): Buffer {\n  return Buffer.concat([\n    Buffer.from([STAKE_IX.UpdateConfig]),\n    Buffer.from([newCooldownSlots != null ? 1 : 0]),\n    u64Le(newCooldownSlots ?? 0n),\n    Buffer.from([newDepositCap != null ? 1 : 0]),\n    u64Le(newDepositCap ?? 0n),\n  ]);\n}\n\n/** Tag 5: TransferAdmin — transfer wrapper admin to pool PDA. */\nexport function encodeStakeTransferAdmin(): Buffer {\n  return Buffer.from([STAKE_IX.TransferAdmin]);\n}\n\n/** Tag 6: AdminSetOracleAuthority — forward to wrapper via CPI. */\nexport function encodeStakeAdminSetOracleAuthority(newAuthority: PublicKey): Buffer {\n  return Buffer.concat([\n    Buffer.from([STAKE_IX.AdminSetOracleAuthority]),\n    newAuthority.toBuffer(),\n  ]);\n}\n\n/** Tag 7: AdminSetRiskThreshold — forward to wrapper via CPI. */\nexport function encodeStakeAdminSetRiskThreshold(newThreshold: bigint | number): Buffer {\n  return Buffer.concat([\n    Buffer.from([STAKE_IX.AdminSetRiskThreshold]),\n    u128Le(newThreshold),\n  ]);\n}\n\n/** Tag 8: AdminSetMaintenanceFee — forward to wrapper via CPI. */\nexport function encodeStakeAdminSetMaintenanceFee(newFee: bigint | number): Buffer {\n  return Buffer.concat([\n    Buffer.from([STAKE_IX.AdminSetMaintenanceFee]),\n    u128Le(newFee),\n  ]);\n}\n\n/** Tag 9: AdminResolveMarket — forward to wrapper via CPI. */\nexport function encodeStakeAdminResolveMarket(): Buffer {\n  return Buffer.from([STAKE_IX.AdminResolveMarket]);\n}\n\n/** Tag 10: AdminWithdrawInsurance — withdraw insurance after market resolution. */\nexport function encodeStakeAdminWithdrawInsurance(amount: bigint | number): Buffer {\n  return Buffer.concat([\n    Buffer.from([STAKE_IX.AdminWithdrawInsurance]),\n    u64Le(amount),\n  ]);\n}\n\n/** Tag 11: AdminSetInsurancePolicy — set withdrawal policy on wrapper. */\nexport function encodeStakeAdminSetInsurancePolicy(\n  authority: PublicKey,\n  minWithdrawBase: bigint | number,\n  maxWithdrawBps: number,\n  cooldownSlots: bigint | number,\n): Buffer {\n  return Buffer.concat([\n    Buffer.from([STAKE_IX.AdminSetInsurancePolicy]),\n    authority.toBuffer(),\n    u64Le(minWithdrawBase),\n    u16Le(maxWithdrawBps),\n    u64Le(cooldownSlots),\n  ]);\n}\n\n// ═══════════════════════════════════════════════════════════════\n// Account Specs (for building TransactionInstructions)\n// ═══════════════════════════════════════════════════════════════\n\nexport interface StakeAccounts {\n  /** InitPool accounts */\n  initPool: {\n    admin: PublicKey;\n    slab: PublicKey;\n    pool: PublicKey;\n    lpMint: PublicKey;\n    vault: PublicKey;\n    vaultAuth: PublicKey;\n    collateralMint: PublicKey;\n    percolatorProgram: PublicKey;\n  };\n  /** Deposit accounts */\n  deposit: {\n    user: PublicKey;\n    pool: PublicKey;\n    userCollateralAta: PublicKey;\n    vault: PublicKey;\n    lpMint: PublicKey;\n    userLpAta: PublicKey;\n    vaultAuth: PublicKey;\n    depositPda: PublicKey;\n  };\n  /** Withdraw accounts */\n  withdraw: {\n    user: PublicKey;\n    pool: PublicKey;\n    userLpAta: PublicKey;\n    lpMint: PublicKey;\n    vault: PublicKey;\n    userCollateralAta: PublicKey;\n    vaultAuth: PublicKey;\n    depositPda: PublicKey;\n  };\n  /** FlushToInsurance accounts (CPI from stake → percolator) */\n  flushToInsurance: {\n    caller: PublicKey;\n    pool: PublicKey;\n    vault: PublicKey;\n    vaultAuth: PublicKey;\n    slab: PublicKey;\n    wrapperVault: PublicKey;\n    percolatorProgram: PublicKey;\n  };\n}\n\n/**\n * Build account keys for InitPool instruction.\n * Returns array of {pubkey, isSigner, isWritable} in the order the program expects.\n */\nexport function initPoolAccounts(a: StakeAccounts['initPool']) {\n  return [\n    { pubkey: a.admin, isSigner: true, isWritable: true },\n    { pubkey: a.slab, isSigner: false, isWritable: false },\n    { pubkey: a.pool, isSigner: false, isWritable: true },\n    { pubkey: a.lpMint, isSigner: false, isWritable: true },\n    { pubkey: a.vault, isSigner: false, isWritable: true },\n    { pubkey: a.vaultAuth, isSigner: false, isWritable: false },\n    { pubkey: a.collateralMint, isSigner: false, isWritable: false },\n    { pubkey: a.percolatorProgram, isSigner: false, isWritable: false },\n    { pubkey: TOKEN_PROGRAM_ID, isSigner: false, isWritable: false },\n    { pubkey: SystemProgram.programId, isSigner: false, isWritable: false },\n    { pubkey: SYSVAR_RENT_PUBKEY, isSigner: false, isWritable: false },\n  ];\n}\n\n/**\n * Build account keys for Deposit instruction.\n */\nexport function depositAccounts(a: StakeAccounts['deposit']) {\n  return [\n    { pubkey: a.user, isSigner: true, isWritable: false },\n    { pubkey: a.pool, isSigner: false, isWritable: true },\n    { pubkey: a.userCollateralAta, isSigner: false, isWritable: true },\n    { pubkey: a.vault, isSigner: false, isWritable: true },\n    { pubkey: a.lpMint, isSigner: false, isWritable: true },\n    { pubkey: a.userLpAta, isSigner: false, isWritable: true },\n    { pubkey: a.vaultAuth, isSigner: false, isWritable: false },\n    { pubkey: a.depositPda, isSigner: false, isWritable: true },\n    { pubkey: TOKEN_PROGRAM_ID, isSigner: false, isWritable: false },\n    { pubkey: SYSVAR_CLOCK_PUBKEY, isSigner: false, isWritable: false },\n    { pubkey: SystemProgram.programId, isSigner: false, isWritable: false },\n  ];\n}\n\n/**\n * Build account keys for Withdraw instruction.\n */\nexport function withdrawAccounts(a: StakeAccounts['withdraw']) {\n  return [\n    { pubkey: a.user, isSigner: true, isWritable: false },\n    { pubkey: a.pool, isSigner: false, isWritable: true },\n    { pubkey: a.userLpAta, isSigner: false, isWritable: true },\n    { pubkey: a.lpMint, isSigner: false, isWritable: true },\n    { pubkey: a.vault, isSigner: false, isWritable: true },\n    { pubkey: a.userCollateralAta, isSigner: false, isWritable: true },\n    { pubkey: a.vaultAuth, isSigner: false, isWritable: false },\n    { pubkey: a.depositPda, isSigner: false, isWritable: true },\n    { pubkey: TOKEN_PROGRAM_ID, isSigner: false, isWritable: false },\n    { pubkey: SYSVAR_CLOCK_PUBKEY, isSigner: false, isWritable: false },\n  ];\n}\n\n/**\n * Build account keys for FlushToInsurance instruction.\n */\nexport function flushToInsuranceAccounts(a: StakeAccounts['flushToInsurance']) {\n  return [\n    { pubkey: a.caller, isSigner: true, isWritable: false },\n    { pubkey: a.pool, isSigner: false, isWritable: true },\n    { pubkey: a.vault, isSigner: false, isWritable: true },\n    { pubkey: a.vaultAuth, isSigner: false, isWritable: false },\n    { pubkey: a.slab, isSigner: false, isWritable: true },\n    { pubkey: a.wrapperVault, isSigner: false, isWritable: true },\n    { pubkey: a.percolatorProgram, isSigner: false, isWritable: false },\n    { pubkey: TOKEN_PROGRAM_ID, isSigner: false, isWritable: false },\n  ];\n}\n","import {\n  Connection,\n  PublicKey,\n  TransactionInstruction,\n  Transaction,\n  Keypair,\n  SendOptions,\n  Commitment,\n  AccountMeta,\n  ComputeBudgetProgram,\n} from \"@solana/web3.js\";\nimport { parseErrorFromLogs } from \"../abi/errors.js\";\n\nexport interface BuildIxParams {\n  programId: PublicKey;\n  keys: AccountMeta[];\n  data: Uint8Array | Buffer;\n}\n\n/**\n * Build a transaction instruction.\n */\nexport function buildIx(params: BuildIxParams): TransactionInstruction {\n  return new TransactionInstruction({\n    programId: params.programId,\n    keys: params.keys,\n    // TransactionInstruction types expect Buffer, but Uint8Array works at runtime.\n    // Cast to avoid Buffer polyfill issues in the browser.\n    data: params.data as Buffer,\n  });\n}\n\nexport interface TxResult {\n  signature: string;\n  slot: number;\n  err: string | null;\n  hint?: string;\n  logs: string[];\n  unitsConsumed?: number;\n}\n\nexport interface SimulateOrSendParams {\n  connection: Connection;\n  ix: TransactionInstruction;\n  signers: Keypair[];\n  simulate: boolean;\n  commitment?: Commitment;\n  computeUnitLimit?: number; // Custom compute unit limit (default: 200,000, max: 1,400,000)\n}\n\n/**\n * Simulate or send a transaction.\n * Returns consistent output for both modes.\n */\nexport async function simulateOrSend(\n  params: SimulateOrSendParams\n): Promise<TxResult> {\n  const { connection, ix, signers, simulate, commitment = \"confirmed\", computeUnitLimit } = params;\n\n  const tx = new Transaction();\n\n  // Add compute budget instruction if custom limit is specified\n  if (computeUnitLimit !== undefined) {\n    tx.add(\n      ComputeBudgetProgram.setComputeUnitLimit({\n        units: computeUnitLimit,\n      })\n    );\n  }\n\n  tx.add(ix);\n  const latestBlockhash = await connection.getLatestBlockhash(commitment);\n  tx.recentBlockhash = latestBlockhash.blockhash;\n  tx.feePayer = signers[0].publicKey;\n\n  if (simulate) {\n    tx.sign(...signers);\n    const result = await connection.simulateTransaction(tx, signers);\n    const logs = result.value.logs ?? [];\n    let err: string | null = null;\n    let hint: string | undefined;\n\n    if (result.value.err) {\n      const parsed = parseErrorFromLogs(logs);\n      if (parsed) {\n        err = `${parsed.name} (0x${parsed.code.toString(16)})`;\n        hint = parsed.hint;\n      } else {\n        err = JSON.stringify(result.value.err);\n      }\n    }\n\n    return {\n      signature: \"(simulated)\",\n      slot: result.context.slot,\n      err,\n      hint,\n      logs,\n      unitsConsumed: result.value.unitsConsumed ?? undefined,\n    };\n  }\n\n  // Send\n  const options: SendOptions = {\n    skipPreflight: false,\n    preflightCommitment: commitment,\n  };\n\n  try {\n    const signature = await connection.sendTransaction(tx, signers, options);\n\n    const confirmation = await connection.confirmTransaction(\n      {\n        signature,\n        blockhash: latestBlockhash.blockhash,\n        lastValidBlockHeight: latestBlockhash.lastValidBlockHeight,\n      },\n      commitment\n    );\n\n    // Fetch logs\n    const txInfo = await connection.getTransaction(signature, {\n      commitment: \"confirmed\",\n      maxSupportedTransactionVersion: 0,\n    });\n\n    const logs = txInfo?.meta?.logMessages ?? [];\n    let err: string | null = null;\n    let hint: string | undefined;\n\n    if (confirmation.value.err) {\n      const parsed = parseErrorFromLogs(logs);\n      if (parsed) {\n        err = `${parsed.name} (0x${parsed.code.toString(16)})`;\n        hint = parsed.hint;\n      } else {\n        err = JSON.stringify(confirmation.value.err);\n      }\n    }\n\n    return {\n      signature,\n      slot: txInfo?.slot ?? 0,\n      err,\n      hint,\n      logs,\n    };\n  } catch (e: unknown) {\n    const message = e instanceof Error ? e.message : String(e);\n    return {\n      signature: \"\",\n      slot: 0,\n      err: message,\n      logs: [],\n    };\n  }\n}\n\n/**\n * Format transaction result for output.\n */\nexport function formatResult(result: TxResult, jsonMode: boolean): string {\n  if (jsonMode) {\n    return JSON.stringify(result, null, 2);\n  }\n\n  const lines: string[] = [];\n\n  if (result.err) {\n    lines.push(`Error: ${result.err}`);\n    if (result.hint) {\n      lines.push(`Hint: ${result.hint}`);\n    }\n    if (result.unitsConsumed !== undefined) {\n      lines.push(`Compute Units: ${result.unitsConsumed.toLocaleString()}`);\n    }\n    if (result.logs.length > 0) {\n      lines.push(\"Logs:\");\n      result.logs.forEach((log) => lines.push(`  ${log}`));\n    }\n  } else {\n    lines.push(`Signature: ${result.signature}`);\n    lines.push(`Slot: ${result.slot}`);\n    if (result.unitsConsumed !== undefined) {\n      lines.push(`Compute Units: ${result.unitsConsumed.toLocaleString()}`);\n    }\n    if (result.signature !== \"(simulated)\") {\n      lines.push(`Explorer: https://explorer.solana.com/tx/${result.signature}`);\n    }\n  }\n\n  return lines.join(\"\\n\");\n}\n","/**\n * Coin-margined perpetual trade math utilities.\n *\n * On-chain PnL formula:\n *   mark_pnl = (oracle - entry) * abs_pos / oracle   (longs)\n *   mark_pnl = (entry - oracle) * abs_pos / oracle   (shorts)\n *\n * All prices are in e6 format (1 USD = 1_000_000).\n * All token amounts are in native units (e.g. lamports).\n */\n\n/**\n * Compute mark-to-market PnL for an open position.\n */\nexport function computeMarkPnl(\n  positionSize: bigint,\n  entryPrice: bigint,\n  oraclePrice: bigint,\n): bigint {\n  if (positionSize === 0n || oraclePrice === 0n) return 0n;\n  const absPos = positionSize < 0n ? -positionSize : positionSize;\n  const diff =\n    positionSize > 0n\n      ? oraclePrice - entryPrice\n      : entryPrice - oraclePrice;\n  return (diff * absPos) / oraclePrice;\n}\n\n/**\n * Compute liquidation price given entry, capital, position and maintenance margin.\n * Uses pure BigInt arithmetic for precision (no Number() truncation).\n */\nexport function computeLiqPrice(\n  entryPrice: bigint,\n  capital: bigint,\n  positionSize: bigint,\n  maintenanceMarginBps: bigint,\n): bigint {\n  if (positionSize === 0n || entryPrice === 0n) return 0n;\n  const absPos = positionSize < 0n ? -positionSize : positionSize;\n  // capitalPerUnit scaled by 1e6 for precision\n  const capitalPerUnitE6 = (capital * 1_000_000n) / absPos;\n\n  if (positionSize > 0n) {\n    const adjusted = (capitalPerUnitE6 * 10000n) / (10000n + maintenanceMarginBps);\n    const liq = entryPrice - adjusted;\n    return liq > 0n ? liq : 0n;\n  } else {\n    // Guard: short positions liquidate when price rises above liq price.\n    // With >= 100% maintenance margin the denominator (10000 - maint) would be <= 0,\n    // meaning the position can never be liquidated. Return max u64 to signal this.\n    if (maintenanceMarginBps >= 10000n) return 18446744073709551615n; // max u64 — unliquidatable\n    const adjusted = (capitalPerUnitE6 * 10000n) / (10000n - maintenanceMarginBps);\n    return entryPrice + adjusted;\n  }\n}\n\n/**\n * Compute estimated liquidation price BEFORE opening a trade.\n * Accounts for trading fees reducing effective capital.\n */\nexport function computePreTradeLiqPrice(\n  oracleE6: bigint,\n  margin: bigint,\n  posSize: bigint,\n  maintBps: bigint,\n  feeBps: bigint,\n  direction: \"long\" | \"short\",\n): bigint {\n  if (oracleE6 === 0n || margin === 0n || posSize === 0n) return 0n;\n  const absPos = posSize < 0n ? -posSize : posSize;\n  const fee = (absPos * feeBps) / 10000n;\n  const effectiveCapital = margin > fee ? margin - fee : 0n;\n  const signedPos = direction === \"long\" ? absPos : -absPos;\n  return computeLiqPrice(oracleE6, effectiveCapital, signedPos, maintBps);\n}\n\n/**\n * Compute trading fee from notional value and fee rate in bps.\n */\nexport function computeTradingFee(\n  notional: bigint,\n  tradingFeeBps: bigint,\n): bigint {\n  return (notional * tradingFeeBps) / 10000n;\n}\n\n/**\n * Compute PnL as a percentage of capital.\n *\n * Uses BigInt scaling to avoid precision loss from Number(bigint) conversion.\n * Number(bigint) silently truncates values above 2^53, which can produce\n * incorrect percentages for large positions (e.g., tokens with 9 decimals\n * where capital > ~9M tokens in native units exceeds MAX_SAFE_INTEGER).\n */\nexport function computePnlPercent(\n  pnlTokens: bigint,\n  capital: bigint,\n): number {\n  if (capital === 0n) return 0;\n  // Scale by 10000 in BigInt-land (2 extra decimal places), then convert once\n  const scaledPct = (pnlTokens * 10_000n) / capital;\n  return Number(scaledPct) / 100;\n}\n\n/**\n * Estimate entry price including fee impact (slippage approximation).\n */\nexport function computeEstimatedEntryPrice(\n  oracleE6: bigint,\n  tradingFeeBps: bigint,\n  direction: \"long\" | \"short\",\n): bigint {\n  if (oracleE6 === 0n) return 0n;\n  const feeImpact = (oracleE6 * tradingFeeBps) / 10000n;\n  return direction === \"long\" ? oracleE6 + feeImpact : oracleE6 - feeImpact;\n}\n\n/**\n * Convert per-slot funding rate (bps) to annualized percentage.\n */\nexport function computeFundingRateAnnualized(\n  fundingRateBpsPerSlot: bigint,\n): number {\n  const bpsPerSlot = Number(fundingRateBpsPerSlot);\n  const slotsPerYear = 2.5 * 60 * 60 * 24 * 365; // ~400ms slots\n  return (bpsPerSlot * slotsPerYear) / 100;\n}\n\n/**\n * Compute margin required for a given notional and initial margin bps.\n */\nexport function computeRequiredMargin(\n  notional: bigint,\n  initialMarginBps: bigint,\n): bigint {\n  return (notional * initialMarginBps) / 10000n;\n}\n\n/**\n * Compute maximum leverage from initial margin bps.\n */\nexport function computeMaxLeverage(initialMarginBps: bigint): number {\n  if (initialMarginBps === 0n) return 1;\n  return Number(10000n / initialMarginBps);\n}\n","/**\n * Input validation utilities for CLI commands.\n * Provides descriptive error messages for invalid input.\n */\n\nimport { PublicKey } from \"@solana/web3.js\";\n\n// Constants for numeric limits\nconst U16_MAX = 65535;\nconst U64_MAX = BigInt(\"18446744073709551615\");\nconst I64_MIN = BigInt(\"-9223372036854775808\");\nconst I64_MAX = BigInt(\"9223372036854775807\");\nconst U128_MAX = (1n << 128n) - 1n;\nconst I128_MIN = -(1n << 127n);\nconst I128_MAX = (1n << 127n) - 1n;\n\nexport class ValidationError extends Error {\n  constructor(\n    public readonly field: string,\n    message: string\n  ) {\n    super(`Invalid ${field}: ${message}`);\n    this.name = \"ValidationError\";\n  }\n}\n\n/**\n * Validate a public key string.\n */\nexport function validatePublicKey(value: string, field: string): PublicKey {\n  try {\n    return new PublicKey(value);\n  } catch {\n    throw new ValidationError(\n      field,\n      `\"${value}\" is not a valid base58 public key. ` +\n        `Example: \"11111111111111111111111111111111\"`\n    );\n  }\n}\n\n/**\n * Validate a non-negative integer index (u16 range for accounts).\n */\nexport function validateIndex(value: string, field: string): number {\n  const num = parseInt(value, 10);\n  if (isNaN(num)) {\n    throw new ValidationError(field, `\"${value}\" is not a valid number`);\n  }\n  if (num < 0) {\n    throw new ValidationError(field, `must be non-negative, got ${num}`);\n  }\n  if (num > U16_MAX) {\n    throw new ValidationError(\n      field,\n      `must be <= ${U16_MAX} (u16 max), got ${num}`\n    );\n  }\n  return num;\n}\n\n/**\n * Validate a non-negative amount (u64 range).\n */\nexport function validateAmount(value: string, field: string): bigint {\n  let num: bigint;\n  try {\n    num = BigInt(value);\n  } catch {\n    throw new ValidationError(\n      field,\n      `\"${value}\" is not a valid number. Use decimal digits only.`\n    );\n  }\n  if (num < 0n) {\n    throw new ValidationError(field, `must be non-negative, got ${num}`);\n  }\n  if (num > U64_MAX) {\n    throw new ValidationError(\n      field,\n      `must be <= ${U64_MAX} (u64 max), got ${num}`\n    );\n  }\n  return num;\n}\n\n/**\n * Validate a u128 value.\n */\nexport function validateU128(value: string, field: string): bigint {\n  let num: bigint;\n  try {\n    num = BigInt(value);\n  } catch {\n    throw new ValidationError(\n      field,\n      `\"${value}\" is not a valid number. Use decimal digits only.`\n    );\n  }\n  if (num < 0n) {\n    throw new ValidationError(field, `must be non-negative, got ${num}`);\n  }\n  if (num > U128_MAX) {\n    throw new ValidationError(\n      field,\n      `must be <= ${U128_MAX} (u128 max), got ${num}`\n    );\n  }\n  return num;\n}\n\n/**\n * Validate an i64 value.\n */\nexport function validateI64(value: string, field: string): bigint {\n  let num: bigint;\n  try {\n    num = BigInt(value);\n  } catch {\n    throw new ValidationError(\n      field,\n      `\"${value}\" is not a valid number. Use decimal digits only, with optional leading minus.`\n    );\n  }\n  if (num < I64_MIN) {\n    throw new ValidationError(\n      field,\n      `must be >= ${I64_MIN} (i64 min), got ${num}`\n    );\n  }\n  if (num > I64_MAX) {\n    throw new ValidationError(\n      field,\n      `must be <= ${I64_MAX} (i64 max), got ${num}`\n    );\n  }\n  return num;\n}\n\n/**\n * Validate an i128 value (trade sizes).\n */\nexport function validateI128(value: string, field: string): bigint {\n  let num: bigint;\n  try {\n    num = BigInt(value);\n  } catch {\n    throw new ValidationError(\n      field,\n      `\"${value}\" is not a valid number. Use decimal digits only, with optional leading minus.`\n    );\n  }\n  if (num < I128_MIN) {\n    throw new ValidationError(\n      field,\n      `must be >= ${I128_MIN} (i128 min), got ${num}`\n    );\n  }\n  if (num > I128_MAX) {\n    throw new ValidationError(\n      field,\n      `must be <= ${I128_MAX} (i128 max), got ${num}`\n    );\n  }\n  return num;\n}\n\n/**\n * Validate a basis points value (0-10000).\n */\nexport function validateBps(value: string, field: string): number {\n  const num = parseInt(value, 10);\n  if (isNaN(num)) {\n    throw new ValidationError(field, `\"${value}\" is not a valid number`);\n  }\n  if (num < 0) {\n    throw new ValidationError(field, `must be non-negative, got ${num}`);\n  }\n  if (num > 10000) {\n    throw new ValidationError(\n      field,\n      `must be <= 10000 (100%), got ${num}`\n    );\n  }\n  return num;\n}\n\n/**\n * Validate a u64 value.\n */\nexport function validateU64(value: string, field: string): bigint {\n  return validateAmount(value, field);\n}\n\n/**\n * Validate a u16 value.\n */\nexport function validateU16(value: string, field: string): number {\n  const num = parseInt(value, 10);\n  if (isNaN(num)) {\n    throw new ValidationError(field, `\"${value}\" is not a valid number`);\n  }\n  if (num < 0) {\n    throw new ValidationError(field, `must be non-negative, got ${num}`);\n  }\n  if (num > U16_MAX) {\n    throw new ValidationError(\n      field,\n      `must be <= ${U16_MAX} (u16 max), got ${num}`\n    );\n  }\n  return num;\n}\n","/**\n * Smart Price Router — automatic oracle selection for any token.\n *\n * Given a token mint, discovers all available price sources (DexScreener, Pyth, Jupiter),\n * ranks them by liquidity/reliability, and returns the best oracle config.\n */\n\n// ---------------------------------------------------------------------------\n// Types\n// ---------------------------------------------------------------------------\n\nexport type PriceSourceType = \"pyth\" | \"dex\" | \"jupiter\";\n\nexport interface PriceSource {\n  type: PriceSourceType;\n  /** Pool address (dex), Pyth feed ID (pyth), or mint (jupiter) */\n  address: string;\n  /** DEX id for dex sources */\n  dexId?: string;\n  /** Pair label e.g. \"SOL / USDC\" */\n  pairLabel?: string;\n  /** USD liquidity depth — higher is better */\n  liquidity: number;\n  /** Latest spot price in USD */\n  price: number;\n  /** Confidence score 0-100 (composite of liquidity, staleness, reliability) */\n  confidence: number;\n}\n\nexport interface PriceRouterResult {\n  mint: string;\n  bestSource: PriceSource | null;\n  allSources: PriceSource[];\n  /** ISO timestamp of resolution */\n  resolvedAt: string;\n}\n\n// ---------------------------------------------------------------------------\n// Top Solana tokens with known Pyth feeds (feed ID → symbol)\n// ---------------------------------------------------------------------------\n\nexport const PYTH_SOLANA_FEEDS: Record<string, { symbol: string; mint: string }> = {\n  // SOL\n  \"ef0d8b6fda2ceba41da15d4095d1da392a0d2f8ed0c6c7bc0f4cfac8c280b56d\": { symbol: \"SOL\", mint: \"So11111111111111111111111111111111111111112\" },\n  // BTC\n  \"e62df6c8b4a85fe1a67db44dc12de5db330f7ac66b72dc658afedf0f4a415b43\": { symbol: \"BTC\", mint: \"9n4nbM75f5Ui33ZbPYXn59EwSgE8CGsHtAeTH5YFeJ9E\" },\n  // ETH\n  \"ff61491a931112ddf1bd8147cd1b641375f79f5825126d665480874634fd0ace\": { symbol: \"ETH\", mint: \"7vfCXTUXx5WJV5JADk17DUJ4ksgau7utNKj4b963voxs\" },\n  // USDC\n  \"eaa020c61cc479712813461ce153894a96a6c00b21ed0cfc2798d1f9a9e9c94a\": { symbol: \"USDC\", mint: \"EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v\" },\n  // USDT\n  \"2b89b9dc8fdf9f34709a5b106b472f0f39bb6ca9ce04b0fd7f2e971688e2e53b\": { symbol: \"USDT\", mint: \"Es9vMFrzaCERmJfrF4H2FYD4KCoNkY11McCe8BenwNYB\" },\n  // BONK\n  \"72b021217ca3fe68922a19aaf990109cb9d84e9ad004b4d2025ad6f529314419\": { symbol: \"BONK\", mint: \"DezXAZ8z7PnrnRJjz3wXBoRgixCa6xjnB7YaB1pPB263\" },\n  // JTO\n  \"b43660a5f790c69354b0729a5ef9d50d68f1df92107540210b9cccba1f947cc2\": { symbol: \"JTO\", mint: \"jtojtomepa8beP8AuQc6eXt5FriJwfFMwQx2v2f9mCL\" },\n  // JUP\n  \"0a0408d619e9380abad35060f9192039ed5042fa6f82301d0e48bb52be830996\": { symbol: \"JUP\", mint: \"JUPyiwrYJFskUPiHa7hkeR8VUtAeFoSYbKedZNsDvCN\" },\n  // PYTH\n  \"0bbf28e9a841a1cc788f6a361b17ca072d0ea3098a1e5df1c3922d06719579ff\": { symbol: \"PYTH\", mint: \"HZ1JovNiVvGrGNiiYvEozEVgZ58xaU3RKwX8eACQBCt3\" },\n  // RAY\n  \"91568bae053f70f0c3fbf32eb55df25ec609fb8a21cfb1a0e3b34fc3caa1eab0\": { symbol: \"RAY\", mint: \"4k3Dyjzvzp8eMZWUXbBCjEvwSkkk59S5iCNLY3QrkX6R\" },\n  // ORCA\n  \"37505261e557e251f40c2c721e52c4c8bfb2e54a12f450d0e24078276ad51b95\": { symbol: \"ORCA\", mint: \"orcaEKTdK7LKz57vaAYr9QeNsVEPfiu6QeMU1kektZE\" },\n  // MNGO\n  \"f9abf5eb70a2e68e21b72b68cc6e0a4d25e1d77e1ec16eae5b93068a2cb81f90\": { symbol: \"MNGO\", mint: \"MangoCzJ36AjZyKwVj3VnYU4GTonjfVEnJmvvWaxLac\" },\n  // MSOL\n  \"c2289a6a43d2ce91c6f55caec370f4acc38a2ed477f58813334c6d03749ff2a4\": { symbol: \"MSOL\", mint: \"mSoLzYCxHdYgdzU16g5QSh3i5K3z3KZK7ytfqcJm7So\" },\n  // JITOSOL\n  \"67be9f519b95cf24338801051f9a808eff0a578ccb388db73b7f6fe1de019ffb\": { symbol: \"JITOSOL\", mint: \"J1toso1uCk3RLmjorhTtrVwY9HJ7X8V9yYac6Y7kGCPn\" },\n  // WIF\n  \"4ca4beeca86f0d164160323817a4e42b10010a724c2217c6ee41b54e6c5c4b03\": { symbol: \"WIF\", mint: \"EKpQGSJtjMFqKZ9KQanSqYXRcF8fBopzLHYxdM65zcjm\" },\n  // RENDER\n  \"3573eb14b04aa0e4f7cf1e7ae1c2a0e3bc6100b2e476876ca079e10e2c42d7c6\": { symbol: \"RENDER\", mint: \"rndrizKT3MK1iimdxRdWabcF7Zg7AR5T4nud4EkHBof\" },\n  // W\n  \"eff7446475e218517566ea99e72a4abec2e1bd8498b43b7d8331e29dcb059389\": { symbol: \"W\", mint: \"85VBFQZC9TZkfaptBWjvUw7YbZjy52A6mjtPGjstQAmQ\" },\n  // TNSR\n  \"05ecd4597cd48fe13d6cc3596c62af4f9675aee06e2e0ca164a73be4b0813f3b\": { symbol: \"TNSR\", mint: \"TNSRxcUxoT9xBG3de7PiJyTDYu7kskLqcpddxnEJAS6\" },\n  // HNT\n  \"649fdd7ec08e8e2a20f425729854e90293dcbe2376abc47197a14da6ff339756\": { symbol: \"HNT\", mint: \"hntyVP6YFm1Hg25TN9WGLqM12b8TQmcknKrdu1oxWux\" },\n  // MOBILE\n  \"ff4c53361e36a9b1caa490f1e46e07e3c472d54d2a4856a1e4609bd4db36bff0\": { symbol: \"MOBILE\", mint: \"mb1eu7TzEc71KxDpsmsKoucSSuuoGLv1drys1oP2jh6\" },\n  // IOT\n  \"8bdd20f0c68bf7370a19389bbb3d17c1db7956c38efa08b2f3dd0e5db9b8c1ef\": { symbol: \"IOT\", mint: \"iotEVVZLEywoTn1QdwNPddxPWszn3zFhEot3MfL9fns\" },\n};\n\n// Reverse lookup: mint → feed ID\nconst MINT_TO_PYTH_FEED = new Map<string, { feedId: string; symbol: string }>();\nfor (const [feedId, info] of Object.entries(PYTH_SOLANA_FEEDS)) {\n  MINT_TO_PYTH_FEED.set(info.mint, { feedId, symbol: info.symbol });\n}\n\n// ---------------------------------------------------------------------------\n// DexScreener fetcher\n// ---------------------------------------------------------------------------\n\nconst SUPPORTED_DEX_IDS = new Set([\"pumpswap\", \"raydium\", \"meteora\"]);\n\nasync function fetchDexSources(mint: string, signal?: AbortSignal): Promise<PriceSource[]> {\n  try {\n    const resp = await fetch(`https://api.dexscreener.com/latest/dex/tokens/${mint}`, {\n      signal,\n      headers: { \"User-Agent\": \"percolator/1.0\" },\n    });\n    const json = (await resp.json()) as any;\n    const pairs = json.pairs || [];\n    const sources: PriceSource[] = [];\n\n    for (const pair of pairs) {\n      if (pair.chainId !== \"solana\") continue;\n      const dexId = (pair.dexId || \"\").toLowerCase();\n      if (!SUPPORTED_DEX_IDS.has(dexId)) continue;\n      const liquidity = pair.liquidity?.usd || 0;\n      if (liquidity < 100) continue;\n\n      // Confidence: based on liquidity tiers\n      let confidence = 30;\n      if (liquidity > 1_000_000) confidence = 90;\n      else if (liquidity > 100_000) confidence = 75;\n      else if (liquidity > 10_000) confidence = 60;\n      else if (liquidity > 1_000) confidence = 45;\n\n      sources.push({\n        type: \"dex\",\n        address: pair.pairAddress,\n        dexId,\n        pairLabel: `${pair.baseToken?.symbol || \"?\"} / ${pair.quoteToken?.symbol || \"?\"}`,\n        liquidity,\n        price: parseFloat(pair.priceUsd) || 0,\n        confidence,\n      });\n    }\n\n    sources.sort((a, b) => b.liquidity - a.liquidity);\n    return sources.slice(0, 10);\n  } catch {\n    return [];\n  }\n}\n\n// ---------------------------------------------------------------------------\n// Pyth lookup\n// ---------------------------------------------------------------------------\n\nfunction lookupPythSource(mint: string): PriceSource | null {\n  const entry = MINT_TO_PYTH_FEED.get(mint);\n  if (!entry) return null;\n  return {\n    type: \"pyth\",\n    address: entry.feedId,\n    pairLabel: `${entry.symbol} / USD (Pyth)`,\n    liquidity: Infinity, // Pyth is considered deep liquidity\n    price: 0, // We don't fetch live price here; caller can enrich\n    confidence: 95, // Pyth is highest reliability for supported tokens\n  };\n}\n\n// ---------------------------------------------------------------------------\n// Jupiter price fallback\n// ---------------------------------------------------------------------------\n\nasync function fetchJupiterSource(mint: string, signal?: AbortSignal): Promise<PriceSource | null> {\n  try {\n    const resp = await fetch(`https://api.jup.ag/price/v2?ids=${mint}`, {\n      signal,\n      headers: { \"User-Agent\": \"percolator/1.0\" },\n    });\n    const json = (await resp.json()) as any;\n    const data = json.data?.[mint];\n    if (!data || !data.price) return null;\n\n    return {\n      type: \"jupiter\",\n      address: mint,\n      pairLabel: `${data.mintSymbol || \"?\"} / USD (Jupiter)`,\n      liquidity: 0, // Jupiter aggregator — no single pool liquidity\n      price: parseFloat(data.price) || 0,\n      confidence: 40, // Fallback — lower confidence\n    };\n  } catch {\n    return null;\n  }\n}\n\n// ---------------------------------------------------------------------------\n// Main resolver\n// ---------------------------------------------------------------------------\n\nexport async function resolvePrice(mint: string, signal?: AbortSignal): Promise<PriceRouterResult> {\n  // Run all lookups in parallel\n  const [dexSources, jupiterSource] = await Promise.all([\n    fetchDexSources(mint, signal),\n    fetchJupiterSource(mint, signal),\n  ]);\n\n  const pythSource = lookupPythSource(mint);\n\n  const allSources: PriceSource[] = [];\n\n  // Add Pyth if available (highest priority for supported tokens)\n  if (pythSource) {\n    // Enrich Pyth price from Jupiter or DEX if available\n    const refPrice = dexSources[0]?.price || jupiterSource?.price || 0;\n    pythSource.price = refPrice;\n    allSources.push(pythSource);\n  }\n\n  // Add DEX sources\n  allSources.push(...dexSources);\n\n  // Add Jupiter as fallback\n  if (jupiterSource) {\n    allSources.push(jupiterSource);\n  }\n\n  // Sort by confidence descending (already accounts for liquidity/reliability)\n  allSources.sort((a, b) => b.confidence - a.confidence);\n\n  return {\n    mint,\n    bestSource: allSources[0] || null,\n    allSources,\n    resolvedAt: new Date().toISOString(),\n  };\n}\n","import { PublicKey } from \"@solana/web3.js\";\n\n/**\n * Centralized PROGRAM_ID configuration\n * \n * Default to environment variable, then fall back to network-specific defaults.\n * This prevents hard-coded program IDs scattered across the codebase.\n */\n\nexport const PROGRAM_IDS = {\n  devnet: {\n    percolator: \"FxfD37s1AZTeWfFQps9Zpebi2dNQ9QSSDtfMKdbsfKrD\",\n    matcher: \"GTRgyTDfrMvBubALAqtHuQwT8tbGyXid7svXZKtWfC9k\",\n  },\n  mainnet: {\n    percolator: \"GM8zjJ8LTBMv9xEsverh6H6wLyevgMHEJXcEzyY3rY24\",\n    matcher: \"\", // TODO: Deploy matcher to mainnet\n  },\n} as const;\n\nexport type Network = \"devnet\" | \"mainnet\";\n\n/**\n * Get the Percolator program ID for the current network\n * \n * Priority:\n * 1. PROGRAM_ID env var (explicit override)\n * 2. Network-specific default (NETWORK env var)\n * 3. Devnet default (safest fallback)\n */\nexport function getProgramId(network?: Network): PublicKey {\n  // Explicit override takes precedence\n  if (process.env.PROGRAM_ID) {\n    return new PublicKey(process.env.PROGRAM_ID);\n  }\n\n  // Use provided network or detect from env\n  const targetNetwork = network ?? (process.env.NETWORK as Network) ?? \"devnet\";\n  const programId = PROGRAM_IDS[targetNetwork].percolator;\n\n  return new PublicKey(programId);\n}\n\n/**\n * Get the Matcher program ID for the current network\n */\nexport function getMatcherProgramId(network?: Network): PublicKey {\n  // Explicit override takes precedence\n  if (process.env.MATCHER_PROGRAM_ID) {\n    return new PublicKey(process.env.MATCHER_PROGRAM_ID);\n  }\n\n  // Use provided network or detect from env\n  const targetNetwork = network ?? (process.env.NETWORK as Network) ?? \"devnet\";\n  const programId = PROGRAM_IDS[targetNetwork].matcher;\n\n  if (!programId) {\n    throw new Error(`Matcher program not deployed on ${targetNetwork}`);\n  }\n\n  return new PublicKey(programId);\n}\n\n/**\n * Get the current network from environment\n * Defaults to devnet for safety\n */\nexport function getCurrentNetwork(): Network {\n  const network = process.env.NETWORK?.toLowerCase();\n  if (network === \"mainnet\" || network === \"mainnet-beta\") {\n    return \"mainnet\";\n  }\n  return \"devnet\";\n}\n"],"mappings":"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A,IACF,MAAM;AAAA,IACN,MAAM;AAAA,EACR;AAAA,EACA,IAAI;AAAA,IACF,MAAM;AAAA,IACN,MAAM;AAAA,EACR;AAAA,EACA,IAAI;AAAA,IACF,MAAM;AAAA,IACN,MAAM;AAAA,EACR;AAAA,EACA,IAAI;AAAA,IACF,MAAM;AAAA,IACN,MAAM;AAAA,EACR;AAAA,EACA,IAAI;AAAA,IACF,MAAM;AAAA,IACN,MAAM;AAAA,EACR;AAAA,EACA,IAAI;AAAA,IACF,MAAM;AAAA,IACN,MAAM;AAAA,EACR;AAAA,EACA,IAAI;AAAA,IACF,MAAM;AAAA,IACN,MAAM;AAAA,EACR;AAAA,EACA,IAAI;AAAA,IACF,MAAM;AAAA,IACN,MAAM;AAAA,EACR;AAAA,EACA,IAAI;AAAA,IACF,MAAM;AAAA,IACN,MAAM;AAAA,EACR;AAAA,EACA,IAAI;AAAA,IACF,MAAM;AAAA,IACN,MAAM;AAAA,EACR;AAAA,EACA,IAAI;AAAA,IACF,MAAM;AAAA,IACN,MAAM;AAAA,EACR;AAAA,EACA,IAAI;AAAA,IACF,MAAM;AAAA,IACN,MAAM;AAAA,EACR;AAAA,EACA,IAAI;AAAA,IACF,MAAM;AAAA,IACN,MAAM;AAAA,EACR;AAAA,EACA,IAAI;AAAA,IACF,MAAM;AAAA,IACN,MAAM;AAAA,EACR;AAAA,EACA,IAAI;AAAA,IACF,MAAM;AAAA,IACN,MAAM;AAAA,EACR;AAAA,EACA,IAAI;AAAA,IACF,MAAM;AAAA,IACN,MAAM;AAAA,EACR;AAAA,EACA,IAAI;AAAA,IACF,MAAM;AAAA,IACN,MAAM;AAAA,EACR;AAAA,EACA,IAAI;AAAA,IACF,MAAM;AAAA,IACN,MAAM;AAAA,EACR;AAAA,EACA,IAAI;AAAA,IACF,MAAM;AAAA,IACN,MAAM;AAAA,EACR;AAAA,EACA,IAAI;AAAA,IACF,MAAM;AAAA,IACN,MAAM;AAAA,EACR;AAAA,EACA,IAAI;AAAA,IACF,MAAM;AAAA,IACN,MAAM;AAAA,EACR;AAAA,EACA,IAAI;AAAA,IACF,MAAM;AAAA,IACN,MAAM;AAAA,EACR;AAAA,EAC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","names":["dv","PublicKey","PublicKey","AccountKind","PublicKey","PublicKey","TOKEN_PROGRAM_ID","ENGINE_BITMAP_OFF","ACCOUNT_SIZE","ENGINE_OFF","dv","readU16LE","readU64LE","readI64LE","readU128LE","readI128LE","results","PublicKey","PublicKey","readU64LE","dv","readU128LE","PublicKey","TOKEN_PROGRAM_ID","PublicKey","SystemProgram","SYSVAR_RENT_PUBKEY","SYSVAR_CLOCK_PUBKEY","TOKEN_PROGRAM_ID","PublicKey","PublicKey"]}